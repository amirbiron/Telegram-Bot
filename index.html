<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>המדריך המלא לפיתוח בוט טלגרם</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f7fafc;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: linear-gradient(135deg, #2d3748, #4a5568);
            color: white;
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            scrollbar-width: thin;
            scrollbar-color: #4a5568 #2d3748;
        }

        /* Progress bar in sidebar */
        .progress-container {
            background: #4a5568;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .progress-bar {
            background: #2d3748;
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #81e6d9, #68d391);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 8px;
        }

        .progress-text {
            font-size: 0.9em;
            color: #81e6d9;
            font-weight: bold;
        }

        .sidebar h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
            color: #81e6d9;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section h3 {
            color: #fbd38d;
            font-size: 1.1em;
            margin-bottom: 10px;
            border-bottom: 2px solid #4a5568;
            padding-bottom: 5px;
        }

        .nav-section ul {
            list-style: none;
        }

        .nav-section li {
            margin: 5px 0;
        }

        .nav-section a {
            color: #e2e8f0;
            text-decoration: none;
            display: block;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .nav-section a:hover {
            background: #4a5568;
            color: #81e6d9;
            transform: translateX(-5px);
        }

        /* Section metadata badges */
        .section-meta {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin: 8px 0 15px 0;
            font-size: 0.8em;
        }

        .time-badge, .difficulty-badge, .cost-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            text-align: center;
        }

        .time-badge {
            background: #4a5568;
            color: #fbd38d;
        }

        .difficulty-badge.beginner {
            background: #00b09b;
            color: white;
        }

        .difficulty-badge.intermediate {
            background: #667eea;
            color: white;
        }

        .difficulty-badge.advanced {
            background: #fc466b;
            color: white;
        }

        .cost-badge.free {
            background: #00b09b;
            color: white;
        }

        .cost-badge.paid {
            background: #ed8936;
            color: white;
        }

        /* Back to top link */
        .back-to-top {
            display: block;
            text-align: center;
            padding: 10px;
            background: #4a5568;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #81e6d9;
        }

        .back-to-top:hover {
            background: #667eea;
            transform: scale(1.05);
        }

        /* Task info indicators */
        .task-info {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            border-right: 4px solid #667eea;
        }

        .time-indicator, .difficulty-indicator, .cost-indicator {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            white-space: nowrap;
        }

        .time-indicator {
            background: #fbd38d;
            color: #744210;
        }

        .difficulty-indicator.beginner {
            background: #00b09b;
            color: white;
        }

        .difficulty-indicator.intermediate {
            background: #667eea;
            color: white;
        }

        .difficulty-indicator.advanced {
            background: #fc466b;
            color: white;
        }

        .cost-indicator.free {
            background: #00b09b;
            color: white;
        }

        .cost-indicator.paid {
            background: #ed8936;
            color: white;
        }

        /* Screenshot placeholders */
        .screenshot-placeholder {
            margin: 20px 0;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            background: #f7fafc;
            overflow: hidden;
        }

        .screenshot-content {
            padding: 20px;
            text-align: center;
        }

        .screenshot-content h5 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .screenshot-content p {
            color: #718096;
            margin-bottom: 15px;
            font-style: italic;
        }

        .placeholder-image {
            background: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            font-family: monospace;
            color: #4a5568;
            font-size: 0.9em;
            line-height: 1.4;
            white-space: pre-line;
        }

        /* Step by step layout */
        .step-by-step {
            margin: 20px 0;
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            border-right: 3px solid #667eea;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            margin-left: 15px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content strong {
            color: #2d3748;
            display: block;
            margin-bottom: 8px;
        }

        .step-content ul {
            margin-top: 8px;
        }

        .step-content li {
            margin-bottom: 5px;
        }

        /* Completed sections styling */
        .nav-section a.completed {
            text-decoration: line-through !important;
            opacity: 0.7 !important;
        }

        /* Quick Start Modal */
        .quick-start-toggle {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            box-shadow: 0 8px 25px rgba(0, 176, 155, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quick-start-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 176, 155, 0.4);
        }

        .quick-start-toggle::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .quick-start-toggle:hover::before {
            left: 100%;
        }

        .quick-start-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            backdrop-filter: blur(5px);
        }

        .quick-start-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            width: 90%;
            max-width: 900px;
            max-height: 90%;
            overflow-y: auto;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            direction: rtl;
        }

        .quick-start-header {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            text-align: center;
            position: relative;
        }

        .quick-start-header h2 {
            margin: 0;
            font-size: 1.8em;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .quick-start-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        /* Quick start specific styling */
        .quick-step {
            background: #f8fafc;
            border-right: 4px solid #00b09b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .quick-step-number {
            position: absolute;
            top: -10px;
            right: 20px;
            background: #00b09b;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .quick-step h4 {
            color: #2d3748;
            margin-bottom: 10px;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .quick-start-content {
                width: 95%;
                margin: 20px;
            }
            
            .quick-start-body {
                padding: 20px;
            }
        }

        /* Main content */
        .main-content {
            margin-right: 300px;
            padding: 40px;
            width: calc(100% - 300px);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.9;
        }

        /* Section styling */
        .section {
            background: white;
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            padding: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .section-header.preparation {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .section-header.basics {
            background: linear-gradient(135deg, #00b09b, #96c93d);
        }

        .section-header.deploy {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .section-header.data {
            background: linear-gradient(135deg, #fc466b, #3f5efb);
        }

        .section-header.advanced {
            background: linear-gradient(135deg, #fa709a, #fee140);
            color: #333;
        }

        .section-header.troubleshoot {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
        }

        .section-header h2 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .section-content {
            padding: 40px;
        }

        /* Content styling */
        .topic {
            margin-bottom: 40px;
            border-right: 4px solid #e2e8f0;
            padding-right: 20px;
        }

        .topic h3 {
            color: #2d3748;
            font-size: 1.8em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .topic h3::before {
            content: "📋";
            margin-left: 10px;
        }

        .subtopic {
            background: #f8fafc;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-right: 3px solid #cbd5e0;
        }

        .subtopic h4 {
            color: #4a5568;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .subtopic h4::before {
            content: "▶️";
            margin-left: 8px;
            font-size: 0.8em;
        }

        /* Code blocks */
        .code-block {
            background: #1a202c;
            color: #f7fafc;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Fira Code', 'Courier New', monospace;
            box-shadow: inset 0 3px 8px rgba(0, 0, 0, 0.4);
            position: relative;
            direction: ltr !important;
            text-align: left !important;
        }

        .code-block::before {
            content: "💻 קוד";
            position: absolute;
            top: 10px;
            left: 15px;
            background: #4a5568;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .code-block pre {
            margin-top: 25px;
            white-space: pre-wrap;
            direction: ltr !important;
            text-align: left !important;
        }

        .code-block h5 {
            color: #68d391;
            margin-bottom: 10px;
            font-size: 1.1em;
            margin-top: 25px;
        }

        /* Special boxes */
        .info-box {
            background: linear-gradient(135deg, #bee3f8, #90cdf4);
            border: none;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: #1a365d;
        }

        .warning-box {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            border: none;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: #742a2a;
        }

        .success-box {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            border: none;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: #1c4532;
        }

        .tip-box {
            background: linear-gradient(135deg, #fef5e7, #fbd38d);
            border: none;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: #744210;
        }

        /* Lists */
        ul, ol {
            margin-right: 25px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
            padding-right: 5px;
        }

        /* Error boxes */
        .error-item {
            background: #fff5f5;
            border-right: 4px solid #e53e3e;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .error-item h5 {
            color: #c53030;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .error-item .solution {
            background: #f0fff4;
            border-right: 3px solid #38a169;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: top;
        }

        th {
            background: #4a5568;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        tr:hover {
            background: #f8fafc;
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Special styling for comparison tables */
        .success-box table th {
            background: #00695c;
        }

        .success-box table td {
            font-size: 0.9em;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }

            .main-content {
                margin-right: 0;
                width: 100%;
                padding: 20px;
            }

            .header {
                padding: 30px;
            }

            .header h1 {
                font-size: 2em;
            }

            .section-content {
                padding: 20px;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Link styling */
        a {
            color: #667eea;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .highlight {
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #333;
        }

        .badge {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .badge.beginner {
            background: #00b09b;
        }

        .badge.intermediate {
            background: #667eea;
        }

        .badge.advanced {
            background: #fc466b;
        }

        /* Progress indicators */
        .level-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .level-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin: 0 5px;
            background: #e2e8f0;
        }

        .level-dot.active {
            background: #667eea;
        }

        .level-dot.beginner {
            background: #00b09b;
        }

        .level-dot.intermediate {
            background: #667eea;
        }

        .level-dot.advanced {
            background: #fc466b;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <h2>🤖 מדריך הבוט</h2>
            
            <div class="nav-section">
                <h3>🔧 חלק 0: הכנות ראשוניות</h3>
                <ul>
                    <li><a href="#botfather-setup">יצירת בוט ב-BotFather</a></li>
                    <li><a href="#mongodb-setup">הגדרת MongoDB Atlas</a></li>
                    <li><a href="#render-account">פתיחת חשבון Render</a></li>
                    <li><a href="#uptimerobot-setup">הגדרת UptimeRobot</a></li>
                    <li><a href="#security-keys">ניהול מפתחות בטוח</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>📚 חלק א': היסודות</h3>
                <ul>
                    <li><a href="#architecture">ארכיטקטורה</a></li>
                    <li><a href="#environment">סביבת פיתוח</a></li>
                    <li><a href="#secrets">ניהול מידע רגיש</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>🚀 חלק ב': העלאה לאוויר</h3>
                <ul>
                    <li><a href="#keep-alive">טריק Keep-Alive</a></li>
                    <li><a href="#docker">Dockerfile נכון</a></li>
                    <li><a href="#render">הגדרת Render</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>💾 חלק ג': נתונים ואחסון</h3>
                <ul>
                    <li><a href="#mongodb">MongoDB Atlas</a></li>
                    <li><a href="#admin">פקודות Admin</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>⚡ חלק ד': תכונות מתקדמות</h3>
                <ul>
                    <li><a href="#api">חיבור API חיצוני</a></li>
                    <li><a href="#hybrid-search">חיפוש היברידי</a></li>
                    <li><a href="#lazy-loading">טעינה עצלה</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>🔧 חלק ה': תחזוקה</h3>
                <ul>
                    <li><a href="#common-errors">תקלות נפוצות</a></li>
                    <li><a href="#best-practices">עקרונות עבודה</a></li>
                    <li><a href="#summary">סיכום והמלצות</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>⚡ חלק ו': שימוש מתקדם</h3>
                <ul>
                    <li><a href="#error-handling">טיפול בשגיאות מתקדם</a></li>
                    <li><a href="#polling-conflicts">פתרון קונפליקטי Polling</a></li>
                    <li><a href="#anthropic-models">מודלי Anthropic API</a></li>
                    <li><a href="#message-editing">עריכת הודעות ללא שגיאות</a></li>
                    <li><a href="#google-search-api">Google Custom Search</a></li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>🤖 המדריך המלא לפיתוח בוט טלגרם</h1>
                <p>מיסודות להתקדמות - מסודר לפי רמות</p>
            </div>

            <div class="info-box">
                <h3>🧭 איך להשתמש במדריך הזה</h3>
                <p><strong>🚀 מתחיל לגמרי?</strong> ← תתחיל ב"הכנות ראשוניות" (חלק 0) ותעבור בסדר.</p>
<p><strong>⚡ רוצה מהיר?</strong> ← השתמש במדריך המהיר של 10 דקות ואחר כך חזור לכאן להעמקה.</p>
<p><strong>🔧 יש לך כבר בוט עובד?</strong> ← אתה יכול לקפוץ לחלק הרלוונטי (משתמש בתפריט השמאלי).</p>
            </div>

            <!-- Quick Start Button -->
            <button class="quick-start-toggle" onclick="openQuickStart()">
                🚀 מהיר התחלה - בוט עובד ב-10 דקות!
            </button>

            <!-- Quick Start Modal -->
            <div class="quick-start-modal" id="quickStartModal">
                <div class="quick-start-content">
                    <div class="quick-start-header">
                        <button class="close-modal" onclick="closeQuickStart()">✕</button>
                        <h2>🚀 מהיר התחלה - בוט טלגרם ב-10 דקות</h2>
                        <p>המטרה: בוט פועל ב-Render תוך 10 דקות שעונה להודעות ועובד 24/7</p>
                    </div>
                    <div class="quick-start-body">
                        
                        <div class="quick-step">
                            <div class="quick-step-number">1</div>
                            <h4>צור את הבוט (דקה 1)</h4>
                            <ol>
                                <li>פתח טלגרם וחפש: <strong>@BotFather</strong></li>
                                <li>שלח: <code>/newbot</code></li>
                                <li>תן שם לבוט (למשל: "הבוט הראשון שלי")</li>
                                <li>תן שם משתמש לבוט (חייב להסתיים ב-<code>bot</code>, למשל: <code>my_first_bot</code>)</li>
                                <li><strong>שמור את הטוקן!</strong> נראה כך: <code>6123456789:AAFGHJ-abcdefghijklmnopqr</code></li>
                            </ol>
                        </div>

                        <div class="quick-step">
                            <div class="quick-step-number">2</div>
                            <h4>כתוב את הקוד (דקות 2-3)</h4>
                            <p><strong>צור תיקייה חדשה</strong> במחשב ובתוכה 2 קבצים:</p>
                            
                            <div class="code-block">
                                <h5>קובץ main.py:</h5>
                                <pre>import os
from telegram.ext import Application, CommandHandler, MessageHandler, filters
from threading import Thread
from flask import Flask

# Keep-Alive server
app = Flask(__name__)

@app.route('/')
def home():
    return "הבוט פועל!"

def run_flask():
    app.run(host='0.0.0.0', port=int(os.environ.get('PORT', 5000)))

# פונקציות הבוט
async def start(update, context):
    await update.message.reply_text("שלום! הבוט שלך עובד!")

async def echo(update, context):
    text = update.message.text
    await update.message.reply_text(f"קיבלתי: {text}")

def main():
    # הפעל Keep-Alive
    Thread(target=run_flask, daemon=True).start()
    
    # בנה את הבוט
    application = Application.builder().token(os.getenv('BOT_TOKEN')).build()
    
    # הוסף פקודות
    application.add_handler(CommandHandler("start", start))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo))
    
    # הרץ את הבוט
    application.run_polling()

if __name__ == '__main__':
    main()</pre>
                            </div>

                            <div class="code-block">
                                <h5>קובץ requirements.txt:</h5>
                                <pre>python-telegram-bot==20.7
flask==3.0.0
python-dotenv==1.0.0</pre>
                            </div>
                        </div>

                        <div class="quick-step">
                            <div class="quick-step-number">3</div>
                            <h4>העלה ל-GitHub (דקות 4-5)</h4>
                            <ol>
                                <li><strong>צור מאגר חדש</strong> ב-GitHub.com</li>
                                <li><strong>העלה את הקבצים:</strong>
                                    <ul>
                                        <li>לחץ "uploading an existing file"</li>
                                        <li>גרור את <code>main.py</code> ו-<code>requirements.txt</code></li>
                                        <li>לחץ "Commit changes"</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>

                        <div class="quick-step">
                            <div class="quick-step-number">4</div>
                            <h4>פתח חשבון ב-Render (דקה 6)</h4>
                            <ol>
                                <li>לך ל-<a href="https://render.com" target="_blank">render.com</a></li>
                                <li>הירשם עם GitHub</li>
                                <li>אשר את החשבון במייל</li>
                            </ol>
                        </div>

                        <div class="quick-step">
                            <div class="quick-step-number">5</div>
                            <h4>צור שירות ב-Render (דקות 7-8)</h4>
                            <ol>
                                <li>לחץ <strong>"New +"</strong> ← <strong>"Web Service"</strong></li>
                                <li>בחר את המאגר שיצרת</li>
                                <li>מלא:
                                    <ul>
                                        <li><strong>Name:</strong> שם לבחירתך (באנגלית)</li>
                                        <li><strong>Build Command:</strong> <code>pip install -r requirements.txt</code></li>
                                        <li><strong>Start Command:</strong> <code>python main.py</code></li>
                                    </ul>
                                </li>
                                <li>לחץ <strong>"Create Web Service"</strong></li>
                            </ol>
                        </div>

                        <div class="quick-step">
                            <div class="quick-step-number">6</div>
                            <h4>הוסף את הטוקן (דקה 9)</h4>
                            <ol>
                                <li><strong>בעמוד השירות ב-Render</strong>, לחץ על <strong>"Environment"</strong></li>
                                <li>לחץ <strong>"Add Secret File"</strong></li>
                                <li>מלא:
                                    <ul>
                                        <li><strong>Filename:</strong> <code>.env</code></li>
                                        <li><strong>Contents:</strong> <code>BOT_TOKEN=הטוקן_שלך_כאן</code></li>
                                    </ul>
                                </li>
                                <li>לחץ <strong>"Save Changes"</strong></li>
                            </ol>
                            <div class="warning-box">
                                <strong>השירות יתחיל להיבנות אוטומטית!</strong>
                            </div>
                        </div>

                        <div class="quick-step">
                            <div class="quick-step-number">7</div>
                            <h4>בדוק שעובד (דקה 10)</h4>
                            <ol>
                                <li><strong>חכה</strong> שהלוגים יראו: <code>"Polling is running"</code></li>
                                <li><strong>פתח את הבוט</strong> בטלגרם</li>
                                <li><strong>שלח</strong> <code>/start</code> - אמור לענות "שלום! הבוט שלך עובד!"</li>
                                <li><strong>שלח</strong> הודעה רגילה - אמור להדהד אותה</li>
                            </ol>
                        </div>

                        <div class="success-box">
                            <h4>🎉 מזל טוב! הבוט שלך פועל!</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                                <div>
                                    <h5>📱 מה הבוט יודע לעשות עכשיו:</h5>
                                    <ul>
                                        <li>✅ עונה ל-<code>/start</code></li>
                                        <li>✅ מחזיר כל הודעה שאתה שולח</li>
                                        <li>✅ פועל 24/7 ללא הפסקה</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5>🔄 איך לעדכן את הבוט:</h5>
                                    <ul>
                                        <li>ערוך את <code>main.py</code> ב-GitHub</li>
                                        <li>Render יבנה אוטומטית את הגרסה החדשה</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h4>🆘 אם משהו לא עובד:</h4>
                            <ul>
                                <li><strong>הבוט לא עונה?</strong> ← בדוק שהטוקן נכון ב-Environment</li>
                                <li><strong>שגיאות בלוגים?</strong> ← בדוק שהקבצים נשמרו נכון ב-GitHub</li>
                                <li><strong>השירות לא עולה?</strong> ← חכה עוד 2-3 דקות, לפעמים זה לוקח זמן</li>
                            </ul>
                        </div>

                        <div class="tip-box">
                            <h4>🚀 מה הלאה?</h4>
                            <p>עכשיו שיש לך בוט עובד, אפשר:</p>
                            <ol>
                                <li><strong>להוסיף פקודות נוספות</strong> (כמו <code>/help</code>, <code>/info</code>)</li>
                                <li><strong>ללמוד מהמדריך המלא</strong> איך להוסיף מסד נתונים, API חיצוני ועוד</li>
                                <li><strong>להתנסות</strong> - שנה את הקוד ותראה מה קורה!</li>
                            </ol>
                            <p style="text-align: center; margin-top: 20px;">
                                <button onclick="closeQuickStart()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">
                                    📚 המשך למדריך המלא
                                </button>
                            </p>
                        </div>

                    </div>
                </div>
            </div>

            <!-- חלק 0: הכנות ראשוניות -->
            <div class="section">
                <div class="section-header" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <h2>🔧 חלק 0: הכנות ראשוניות</h2>
                    <div class="level-indicator">
                        <span class="badge beginner">הכרחי</span>
                        <div class="level-dot beginner active"></div>
                        <div class="level-dot"></div>
                        <div class="level-dot"></div>
                    </div>
                    <p style="margin-top: 10px; opacity: 0.9;">שלב זה הכרחי למי שמתחיל מאפס - נגדיר את כל החשבונות והמפתחות</p>
                </div>
                <div class="section-content">
                    <div class="topic" id="botfather-setup">
                        <h3>יצירת בוט ב-BotFather</h3>
                        
                        <!-- Visual indicators -->
                        <div class="task-info">
                            <span class="time-indicator">⏱️ זמן משוער: 5-7 דקות</span>
                            <span class="difficulty-indicator beginner">🔰 רמת קושי: קל מאוד</span>
                            <span class="cost-indicator free">💰 עלות: חינמי לחלוטין</span>
                        </div>
                        
                        <div class="info-box">
                            <h4>🤖 מה זה BotFather?</h4>
                            <p>BotFather הוא הבוט הרשמי של טלגרם שמנהל את כל הבוטים בפלטפורמה. דרכו תוכל ליצור, לערוך ולנהל את הבוטים שלך.</p>
                        </div>

                        <!-- Screenshot placeholder -->
                        <div class="screenshot-placeholder">
                            <div class="screenshot-content">
                                
                                <div class="placeholder-image">🤖 @BotFather ✅</div>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>צעדים מפורטים:</h4>
                            <div class="step-by-step">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <strong>פתח את טלגרם</strong> (אפליקציה או דפדפן)
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <strong>חפש את BotFather:</strong>
                                        <ul>
                                            <li>בחיפוש, כתוב: <code>@BotFather</code></li>
                                            <li>או לחץ על הקישור: <a href="https://t.me/BotFather" target="_blank">https://t.me/BotFather</a></li>
                                            <li>וודא שיש עליו עיטור כחול (✓) - זה הבוט הרשמי</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <strong>התחל שיחה:</strong>
                                        <ul>
                                            <li>לחץ "התחל" או "Start"</li>
                                            <li>תקבל הודעת ברוכים הבאים עם רשימת פקודות</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <strong>צור בוט חדש:</strong>
                                        <ul>
                                            <li>שלח: <code>/newbot</code></li>
                                            <li>BotFather ישאל: "Alright, a new bot. How are we going to call it?"</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">5</div>
                                    <div class="step-content">
                                        <strong>תן שם לבוט:</strong>
                                        <ul>
                                            <li>כתוב שם יפה ותיאורי, למשל: "הבוט הראשון שלי"</li>
                                            <li>זה השם שמשתמשים יראו</li>
                                            <li>יכול להיות בעברית ועם רווחים</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">6</div>
                                    <div class="step-content">
                                        <strong>תן שם משתמש לבוט:</strong>
                                        <ul>
                                            <li>BotFather ישאל: "Now let's choose a username for your bot"</li>
                                            <li>חייב להסתיים ב-<code>bot</code> או <code>Bot</code></li>
                                            <li>רק אותיות אנגליות, מספרים וקו תחתון</li>
                                            <li>דוגמאות: <code>my_first_bot</code>, <code>testBot123</code></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="success-box">
                            <h4>🎉 קיבלת את הטוקן!</h4>
                            <p>אם הכל הלך בסדר, תקבל הודעה כזו:</p>
                            
                            <!-- Screenshot placeholder -->
                            <div class="screenshot-placeholder">
                                <div class="screenshot-content">
            
                                    <div class="placeholder-image">
                                        Done! Congratulations on your new bot...<br>
                                        <strong>6123456789:AAFGHJ-abcdefghijklmnopqr</strong>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="code-block">
                                <pre>Done! Congratulations on your new bot. You will find it at t.me/your_bot_username.

You can now add a description, about section and profile picture for your bot...

Use this token to access the HTTP API:
6123456789:AAFGHJ-abcdefghijklmnopqrstuvwxyz_1234

Keep your token secure and store it safely, it can be used by anyone to control your bot.</pre>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ חשוב מאוד!</h4>
                            <ul>
                                <li><strong>העתק את הטוקן למקום בטוח</strong> - תצטרך אותו בהמשך</li>
                                <li><strong>אל תשתף את הטוקן עם אף אחד</strong> - מי שיש לו את הטוקן יכול לשלוט בבוט שלך</li>
                                <li><strong>אם הטוקן נדלף</strong> - אפשר לבטל אותו ולקבל חדש דרך BotFather</li>
                            </ul>
                        </div>

                        <div class="subtopic">
                            <h4>פקודות נוספות שימושיות:</h4>
                            <ul>
                                <li><code>/mybots</code> - רשימת כל הבוטים שלך</li>
                                <li><code>/token</code> - קבלת הטוקן שוב (אם שכחת)</li>
                                <li><code>/revoke</code> - ביטול טוקן נוכחי וקבלת חדש</li>
                                <li><code>/setdescription</code> - הוספת תיאור לבוט</li>
                                <li><code>/setabouttext</code> - הוספת טקסט "אודות"</li>
                                <li><code>/setuserpic</code> - הוספת תמונת פרופיל</li>
                            </ul>
                        </div>
                    </div>

                    <div class="topic" id="mongodb-setup">
                        <h3>הגדרת MongoDB Atlas</h3>
                        
                        <!-- Visual indicators -->
                        <div class="task-info">
                            <span class="time-indicator">⏱️ זמן משוער: 15-20 דקות</span>
                            <span class="difficulty-indicator beginner">🔰 רמת קושי: קל</span>
                            <span class="cost-indicator free">💰 עלות: חינמי (512MB)</span>
                        </div>
                        
                        <div class="info-box">
                            <h4>🗃️ מה זה בכלל מסד נתונים?</h4>
                            <p><strong>מסד נתונים</strong> זה כמו "מוח" של הבוט - המקום שבו הוא זוכר דברים:</p>
                            <ul>
                                <li><strong>מי השתמש בבוט</strong> (רשימת משתמשים)</li>
                                <li><strong>מתי כל אחד השתמש</strong> (לסטטיסטיקות)</li>
                                <li><strong>העדפות משתמשים</strong> (שפה, הגדרות)</li>
                                <li><strong>היסטוריית שיחות</strong> (אם רוצים לזכור הקשר)</li>
                                <li><strong>תוכן הבוט</strong> (מאמרים, שאלות ותשובות)</li>
                            </ul>
                        </div>

                        <div class="success-box">
                            <h4>🔄 MongoDB vs קבצי טקסט - למה זה יותר טוב?</h4>
                            <table style="width: 100%; margin: 10px 0;">
                                <tr>
                                    <th>קבצי טקסט רגילים</th>
                                    <th>MongoDB</th>
                                </tr>
                                <tr>
                                    <td>❌ איטי עם הרבה נתונים</td>
                                    <td>✅ מהיר אפילו עם מיליוני רשומות</td>
                                </tr>
                                <tr>
                                    <td>❌ קשה לחפש ולמיין</td>
                                    <td>✅ חיפוש וסינון מתקדם</td>
                                </tr>
                                <tr>
                                    <td>❌ בעיות עם משתמשים במקביל</td>
                                    <td>✅ אלפי משתמשים במקביל</td>
                                </tr>
                                <tr>
                                    <td>❌ אין גיבוי אוטומטי</td>
                                    <td>✅ גיבוי אוטומטי כל יום</td>
                                </tr>
                            </table>
                        </div>

                        <div class="tip-box">
                            <h4>💡 למה MongoDB Atlas דווקא?</h4>
                            <ul>
                                <li><strong>חינמי:</strong> 512MB אחסון ללא עלות (מספיק לאלפי משתמשים)</li>
                                <li><strong>מנוהל:</strong> גיבויים ואבטחה אוטומטיים</li>
                                <li><strong>קל להתחיל:</strong> לא צריך להתקין כלום במחשב</li>
                                <li><strong>יציב:</strong> זמינות גבוהה 24/7</li>
                                <li><strong>גמיש:</strong> קל להוסיף שדות חדשים ללא מחיקת נתונים</li>
                            </ul>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 1: יצירת חשבון</h4>
                            
                            <!-- Screenshot placeholder -->
                            <div class="screenshot-placeholder">
                                <div class="screenshot-content">
                                    
                                    <div class="placeholder-image">MongoDB Atlas - Sign Up
🌟 Try free
📧 Email: your@email.com
🔒 Password: ••••••••</div>
                                </div>
                            </div>
                            
                            <div class="step-by-step">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <strong>לך ל-MongoDB Atlas:</strong>
                                        <a href="https://www.mongodb.com/cloud/atlas/register" target="_blank">https://www.mongodb.com/cloud/atlas/register</a>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <strong>הירשם:</strong>
                                        <ul>
                                            <li>מלא אימייל וסיסמה</li>
                                            <li>או השתמש ב-Google/GitHub</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <strong>אמת את האימייל</strong> (בדוק גם ספאם)
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <strong>מלא פרטים נוספים:</strong>
                                        <ul>
                                            <li>שם פרטי ומשפחה</li>
                                            <li>בחר "I'm learning MongoDB"</li>
                                            <li>בחר "Personal" או "Work"</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 2: יצירת Cluster (מסד הנתונים)</h4>
                            
                            <!-- Screenshot placeholder -->
                            <div class="screenshot-placeholder">
                                <div class="screenshot-content">
                                    
                                    <div class="placeholder-image">Choose Your Plan
🟢 M0 Sandbox - FREE
512 MB Storage
Shared RAM
⭐ $0/month forever</div>
                                </div>
                            </div>
                            
                            <div class="step-by-step">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <strong>בעמוד הראשי:</strong>
                                        <ul>
                                            <li>לחץ "Build a Database"</li>
                                            <li>או "Create a Cluster"</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <strong>בחר תוכנית:</strong>
                                        <ul>
                                            <li>בחר <span class="highlight">"M0 Sandbox"</span> (החינמית)</li>
                                            <li>וודא שכתוב "FREE" ליד התוכנית</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <strong>בחר מיקום:</strong>
                                        <ul>
                                            <li>ספק: <strong>AWS</strong> (מומלץ)</li>
                                            <li>אזור: <strong>eu-central-1</strong> (פרנקפורט - הכי קרוב לישראל)</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <strong>תן שם ל-Cluster:</strong>
                                        <ul>
                                            <li>השאר את ברירת המחדל: "Cluster0"</li>
                                            <li>או תן שם תיאורי: "telegram-bot"</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">5</div>
                                    <div class="step-content">
                                        <strong>לחץ "Create Cluster"</strong> - זה ייקח 1-3 דקות
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 3: הגדרת אבטחה</h4>
                            
                            <!-- Screenshot placeholder -->
                            <div class="screenshot-placeholder">
                                <div class="screenshot-content">
                                    
                                    <div class="placeholder-image">Database Access
👤 Username: botuser
🔑 Password: ••••••••••
📝 Role: Read and write to any database</div>
                                </div>
                            </div>
                            
                            <div class="step-by-step">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <strong>יצירת משתמש מסד נתונים:</strong>
                                        <ul>
                                            <li>בעמוד Security ← Database Access</li>
                                            <li>לחץ "Add New Database User"</li>
                                            <li>שם משתמש: <code>botuser</code> (או כל שם)</li>
                                            <li>סיסמה: <strong>צור סיסמה חזקה ושמור אותה!</strong></li>
                                            <li>הרשאות: <strong>"Read and write to any database"</strong></li>
                                            <li>לחץ "Add User"</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <strong>הגדרת IP Whitelist:</strong>
                                        <ul>
                                            <li>בעמוד Security ← Network Access</li>
                                            <li>לחץ "Add IP Address"</li>
                                            <li>בחר <strong>"Allow Access from Anywhere"</strong> (0.0.0.0/0)</li>
                                            <li>זה בטוח כי יש לך סיסמה חזקה</li>
                                            <li>לחץ "Confirm"</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 4: קבלת Connection String</h4>
                            
                            <!-- Screenshot placeholder -->
                            <div class="screenshot-placeholder">
                                <div class="screenshot-content">
                                    
                                    <div class="placeholder-image">Connect to Cluster0
🔗 Connect your application
🐍 Python 3.6 or later
📋 mongodb+srv://botuser:&lt;password&gt;@cluster0...</div>
                                </div>
                            </div>
                            
                            <div class="step-by-step">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <strong>חזור לעמוד הראשי</strong> (Database ← Clusters)
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <strong>לחץ "Connect"</strong> על ה-Cluster שלך
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <strong>בחר "Connect your application"</strong>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <strong>בחר Driver:</strong>
                                        <ul>
                                            <li>Driver: <strong>Python</strong></li>
                                            <li>Version: <strong>3.6 or later</strong></li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="step">
                                    <div class="step-number">5</div>
                                    <div class="step-content">
                                        <strong>העתק את ה-Connection String:</strong>
                                        <div class="code-block">
                                            <pre>mongodb+srv://botuser:&lt;password&gt;@cluster0.xxxxx.mongodb.net/?retryWrites=true&amp;w=majority</pre>
                                        </div>
                                        <ul>
                                            <li>החלף <code>&lt;password&gt;</code> בסיסמה האמיתית של המשתמש</li>
                                            <li>הוסף שם מסד נתונים לפני הסימן <code>?</code></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="success-box">
                            <h4>✅ דוגמה ל-Connection String מוכן:</h4>
                            <div class="code-block">
                                <pre>mongodb+srv://botuser:myPassword123@cluster0.abc12.mongodb.net/telegram_bot?retryWrites=true&w=majority</pre>
                            </div>
                            <p><strong>שמור את זה במקום בטוח!</strong> תצטרך אותו בקובץ .env</p>
                        </div>
                    </div>

                    <div class="topic" id="render-account">
                        <h3>פתיחת חשבון Render</h3>
                        
                        <div class="info-box">
                            <h4>☁️ למה Render?</h4>
                            <ul>
                                <li><strong>חינמי:</strong> 750 שעות חינם בחודש (מספיק לבוט 24/7)</li>
                                <li><strong>פשוט:</strong> חיבור ישיר ל-GitHub</li>
                                <li><strong>אמין:</strong> פריסה אוטומטית עם כל push</li>
                                <li><strong>תמיכה:</strong> Python מובנה</li>
                            </ul>
                        </div>

                        <div class="subtopic">
                            <h4>צעדי הרישום:</h4>
                            <ol>
                                <li><strong>לך לאתר:</strong> <a href="https://render.com" target="_blank">render.com</a></li>
                                <li><strong>לחץ "Get Started"</strong> או "Sign Up"</li>
                                <li><strong>בחר שיטת הרישום:</strong>
                                    <ul>
                                        <li><span class="highlight">מומלץ:</span> "Continue with GitHub" - הכי נוח לחיבור המאגרים</li>
                                        <li>אלטרנטיבה: הרישום עם אימייל</li>
                                    </ul>
                                </li>
                                <li><strong>אם בחרת GitHub:</strong>
                                    <ul>
                                        <li>תועבר לעמוד GitHub</li>
                                        <li>אשר את ההרשאות</li>
                                        <li>Render יקבל גישה לרשימת הrepositories שלך</li>
                                    </ul>
                                </li>
                                <li><strong>מלא פרטים נוספים:</strong>
                                    <ul>
                                        <li>שם פרטי ומשפחה</li>
                                        <li>איזור גיאוגרפי (לא משפיע על השירות החינמי)</li>
                                    </ul>
                                </li>
                                <li><strong>אמת אימייל</strong> אם נדרש</li>
                            </ol>
                        </div>

                        <div class="subtopic">
                            <h4>הכרת הממשק:</h4>
                            <ul>
                                <li><strong>Dashboard:</strong> כל השירותים שלך</li>
                                <li><strong>New +:</strong> כפתור ליצירת שירות חדש</li>
                                <li><strong>Account Settings:</strong> הגדרות חשבון ותשלום</li>
                                <li><strong>Usage:</strong> צפייה בצריכת משאבים</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ מגבלות התוכנית החינמית:</h4>
                            <ul>
                                <li>750 שעות בחודש (כ-31 יום של שירות רציף)</li>
                                <li>השירות "נרדם" אחרי 15 דקות ללא פעילות</li>
                                <li>זיכרון מוגבל ל-512MB</li>
                                <li>לכן נשתמש בטריק Keep-Alive + UptimeRobot</li>
                            </ul>
                        </div>
                    </div>

                    <div class="topic" id="uptimerobot-setup">
                        <h3>הגדרת UptimeRobot</h3>
                        
                        <div class="info-box">
                            <h4>📡 מה זה UptimeRobot?</h4>
                            <p>שירות חינמי שבודק כל 5 דקות אם האתר שלך פועל. כשהוא שולח בקשה לשירות ב-Render, זה מעיר אותו ומונע ממנו "להירדם".</p>
                        </div>

                        <div class="subtopic">
                            <h4>יצירת חשבון:</h4>
                            <ol>
                                <li><strong>לך ל:</strong> <a href="https://uptimerobot.com" target="_blank">uptimerobot.com</a></li>
                                <li><strong>לחץ "Free Sign Up"</strong></li>
                                <li><strong>מלא פרטים:</strong>
                                    <ul>
                                        <li>אימייל</li>
                                        <li>סיסמה</li>
                                        <li>שם מלא</li>
                                    </ul>
                                </li>
                                <li><strong>אמת אימייל</strong> (בדוק גם ספאם)</li>
                                <li><strong>התחבר לחשבון</strong></li>
                            </ol>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ חשוב!</h4>
                            <p>תוכל להגדיר את UptimeRobot רק <strong>אחרי</strong> שהשירות ב-Render כבר פועל ויש לך כתובת URL. זה יהיה בחלק "העלאה לאוויר".</p>
                        </div>

                        <div class="subtopic">
                            <h4>מה שתעשה מאוחר יותר:</h4>
                            <ol>
                                <li><strong>תוסיף Monitor חדש</strong></li>
                                <li><strong>סוג:</strong> HTTP(s)</li>
                                <li><strong>URL:</strong> הכתובת של השירות ב-Render</li>
                                <li><strong>שם:</strong> שם תיאורי לבוט</li>
                                <li><strong>מרווח בדיקה:</strong> 5 דקות (התוכנית החינמית)</li>
                            </ol>
                        </div>

                        <div class="tip-box">
                            <h4>💡 טיפ:</h4>
                            <p>UptimeRobot יכול גם לשלוח לך התראות (אימייל/SMS) אם הבוט נפל. זה שימושי למעקב על יציבות הבוט.</p>
                        </div>
                    </div>

                    <div class="topic" id="security-keys">
                        <h3>ניהול מפתחות בטוח</h3>
                        
                        <div class="warning-box">
                            <h4>🔐 חוקי זהב לאבטחת מפתחות:</h4>
                            <ul>
                                <li><strong>אף פעם לא בקוד:</strong> אל תכתוב מפתחות ישירות בקבצי Python</li>
                                <li><strong>לא ב-Git:</strong> אל תעלה מפתחות ל-GitHub/GitLab</li>
                                <li><strong>משתני סביבה:</strong> השתמש תמיד בקבצי .env או Secret Files</li>
                                <li><strong>גיבוי בטוח:</strong> שמור עותק של המפתחות במקום בטוח (מנהל סיסמאות)</li>
                            </ul>
                        </div>

                        <div class="subtopic">
                            <h4>איפה לשמור מפתחות:</h4>
                            
                            <div class="success-box">
                                <h5>✅ מקומות בטוחים:</h5>
                                <ul>
                                    <li><strong>מנהל סיסמאות:</strong> 1Password, Bitwarden, LastPass</li>
                                    <li><strong>קובץ מוצפן:</strong> VeraCrypt, 7-Zip עם סיסמה</li>
                                    <li><strong>מחברת פיזית:</strong> בכספת או במקום בטוח</li>
                                    <li><strong>Notes מוצפן:</strong> באפליקציות עם הצפנה</li>
                                </ul>
                            </div>

                            <div class="error-item">
                                <h5>❌ מקומות מסוכנים:</h5>
                                <ul>
                                    <li>ישירות בקוד המקור</li>
                                    <li>הערות ב-GitHub</li>
                                    <li>אימיילים</li>
                                    <li>הודעות ווטסאפ/טלגרם</li>
                                    <li>מסמכי Google Docs ציבוריים</li>
                                    <li>קבצי טקסט לא מוגנים</li>
                                </ul>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>תבנית ניהול מפתחות:</h4>
                            <div class="code-block">
                                <h5>קובץ .env מסודר:</h5>
                                <pre># Telegram Bot Configuration
BOT_TOKEN=6123456789:AAFGHJ-abcdefghijklmnopqrstuvwxyz_1234
ADMIN_ID=123456789

# Database Configuration  
MONGO_URI=mongodb+srv://user:pass@cluster0.xxxxx.mongodb.net/telegram_bot?retryWrites=true&w=majority

# External APIs (אם נדרש)
OPENAI_API_KEY=sk-...
GEMINI_API_KEY=AIzaSy...

# Environment Settings
ENVIRONMENT=production
DEBUG=false</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>מה לעשות אם מפתח נדלף:</h4>
                            <ol>
                                <li><strong>אל תיכנס לפאניקה</strong> - זה קורה לכולם</li>
                                <li><strong>בטל את המפתח מיד:</strong>
                                    <ul>
                                        <li>בוט טלגרם: /revoke ב-BotFather</li>
                                        <li>MongoDB: החלף סיסמת משתמש</li>
                                        <li>APIs אחרים: בטל ויצור מפתח חדש</li>
                                    </ul>
                                </li>
                                <li><strong>עדכן את השירותים</strong> עם המפתח החדש</li>
                                <li><strong>בדוק לוגים</strong> לפעילות חשודה</li>
                                <li><strong>למד מהטעות</strong> ושפר את תהליך האבטחה</li>
                            </ol>
                        </div>

                        <div class="tip-box">
                            <h4>💡 טיפים לאבטחה מתקדמת:</h4>
                            <ul>
                                <li><strong>רוטציה:</strong> החלף מפתחות מדי פעם</li>
                                <li><strong>הרשאות מינימליות:</strong> תן רק את ההרשאות הנדרשות</li>
                                <li><strong>ניטור:</strong> עקוב אחר שימוש במפתחות</li>
                                <li><strong>גיבוי:</strong> שמור מפתחות גיבוי במקום נפרד</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- חלק א': היסודות -->
            <div class="section">
                <div class="section-header basics">
                    <h2>📚 חלק א': היסודות</h2>
                    <div class="level-indicator">
                        <span class="badge beginner">מתחילים</span>
                        <div class="level-dot beginner active"></div>
                        <div class="level-dot"></div>
                        <div class="level-dot"></div>
                    </div>
                </div>
                <div class="section-content">
                    <div class="topic" id="architecture">
                        <h3>ארכיטקטורה: איך הבוט "מקשיב"?</h3>
                        
                        <div class="subtopic">
                            <h4>שתי השיטות העיקריות:</h4>
                            
                            <div class="success-box">
                                <h5>🔄 Polling (מומלץ למתחילים)</h5>
                                <ul>
                                    <li>הבוט שואל את טלגרם כל כמה שניות "יש הודעות חדשות?"</li>
                                    <li>פשוט ויציב</li>
                                    <li>קל לאבחון תקלות</li>
                                    <li>עובד על כל שרת</li>
                                </ul>
                            </div>

                            <div class="info-box">
                                <h5>⚡ Webhooks (למתקדמים)</h5>
                                <ul>
                                    <li>טלגרם שולח הודעה ברגע שהיא מגיעה</li>
                                    <li>מהיר יותר</li>
                                    <li>מתאים לבוטים גדולים</li>
                                    <li>דורש HTTPS ויותר הגדרות</li>
                                </ul>
                            </div>

                            <div class="tip-box">
                                <strong>🎯 המלצה:</strong> תתחיל עם Polling. תעבור ל-Webhooks רק כשיש לך אלפי משתמשים.
                            </div>
                        </div>
                    </div>

                    <div class="topic" id="environment">
                        <h3>סביבת הפיתוח</h3>
                        
                        <div class="subtopic">
                            <h4>תלויות בסיסיות (requirements.txt):</h4>
                            <div class="code-block">
                                <pre>python-telegram-bot==20.7
python-dotenv==1.0.0
flask==3.0.0</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>לתכונות מתקדמות:</h4>
                            <div class="code-block">
                                <pre>python-telegram-bot[job-queue]==20.7  # למשימות מתוזמנות
pymongo==4.6.0                        # למסד נתונים
requests==2.31.0                      # לחיבור API חיצוני</pre>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h5>⚠️ כללי חשובים:</h5>
                            <ul>
                                <li><strong>שמות קבצים:</strong> תמיד אותיות קטנות (<code>requirements.txt</code>, לא <code>Requirements.txt</code>)</li>
                                <li><strong>גרסאות:</strong> תמיד צמד מספר גרסה מדויק (<code>==20.7</code>)</li>
                                <li><strong>ארגון:</strong> קובץ נפרד לכל ספרייה</li>
                            </ul>
                        </div>
                    </div>

                    <div class="topic" id="secrets">
                        <h3>ניהול מידע רגיש</h3>
                        
                        <div class="subtopic">
                            <h4>קובץ .env (מקומי):</h4>
                            <div class="code-block">
                                <pre>BOT_TOKEN=6123456789:AAFGHJ-abcdefghijklmnopqr
ADMIN_ID=123456789
MONGO_URI=mongodb+srv://user:pass@cluster.mongodb.net/dbname</pre>
                            </div>
                        </div>

                        <div class="error-item">
                            <h5>🔒 חוקי זהב:</h5>
                            <ul>
                                <li>❌ <strong>לעולם לא</strong> לשים טוקנים בקוד המקור</li>
                                <li>✅ השתמש ב-<code>.env</code> למקומי</li>
                                <li>✅ השתמש ב-Secret Files ב-Render</li>
                                <li>✅ הוסף <code>.env</code> ל-<code>.gitignore</code></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- חלק ב': העלאה לאוויר -->
            <div class="section">
                <div class="section-header deploy">
                    <h2>🚀 חלק ב': העלאה לאוויר</h2>
                    <div class="level-indicator">
                        <span class="badge intermediate">בינוני</span>
                        <div class="level-dot"></div>
                        <div class="level-dot intermediate active"></div>
                        <div class="level-dot"></div>
                    </div>
                </div>
                <div class="section-content">
                    <div class="topic" id="keep-alive">
                        <h3>טריק ה-Keep-Alive (קריטי לחינמי)</h3>
                        
                        <div class="warning-box">
                            <h4>🤔 מה הבעיה עם שירותים חינמיים?</h4>
                            <p>שירותי ענן חינמיים כמו Render חוסכים במשאבים על ידי "הרדמת" אפליקציות שלא משתמשים בהן. אחרי 15 דקות ללא פעילות, השירות "נרדם" ולוקח זמן להתעורר כשמגיעה הודעה חדשה.</p>
                            <p><strong>התוצאה:</strong> המשתמש שולח הודעה לבוט, ממתין 30-60 שניות, והבוט מגיב רק אז.</p>
                        </div>

                        <div class="info-box">
                            <h4>💡 מה הפתרון?</h4>
                            <p><strong>טריק Keep-Alive:</strong> נריץ שרת ווב קטן במקביל לבוט. השרת הזה יענה לבדיקות של UptimeRobot כל 5 דקות, וככה Render יחשוב שיש תעבורה ולא ירדים את השירות.</p>
                        </div>

                        <div class="subtopic">
                            <h4>איך זה עובד - תרשים:</h4>
                            <div class="code-block">
                                <pre>UptimeRobot (כל 5 דקות) 
      ↓ 
  בדיקה: "האתר פועל?"
      ↓
   שרת Flask עונה: "כן!"
      ↓
  Render: "יש תעבורה, אשאיר פעיל"
      ↓
   הבוט ממשיך לרוץ ללא הפסקה</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>הקוד המלא - איפה לשים מה:</h4>
                            
                            <div class="success-box">
                                <h5>📁 מבנה התיקיות שלך:</h5>
                                <div class="code-block">
                                    <pre>my-telegram-bot/
├── main.py          ← הקובץ הראשי (הכל כאן)
├── requirements.txt ← רשימת הספריות
├── .env            ← המפתחות (מקומי בלבד)
└── README.md       ← תיאור הפרויקט (אופציונלי)</pre>
                                </div>
                            </div>

                            <div class="code-block">
                                <h5>📄 קובץ main.py מלא עם Keep-Alive:</h5>
                                <pre>import os
import logging
from telegram.ext import Application, CommandHandler, MessageHandler, filters
from threading import Thread
from flask import Flask

# ===== חלק 1: הגדרת שרת Keep-Alive =====
app = Flask(__name__)

@app.route('/')
def health_check():
    return "🤖 הבוט פועל ומחכה להודעות!", 200

@app.route('/status')
def status():
    return {
        "status": "active",
        "message": "Bot is running"
    }

def run_flask():
    """מריץ את שרת ה-Flask ב-thread נפרד"""
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port, debug=False)

# ===== חלק 2: פונקציות הבוט =====
async def start(update, context):
    """פקודת /start"""
    user_name = update.effective_user.first_name
    welcome_message = f"שלום {user_name}! 👋\nהבוט שלך פועל ומוכן לשירות!"
    await update.message.reply_text(welcome_message)

async def echo(update, context):
    """מחזיר כל הודעה שמקבל"""
    user_message = update.message.text
    response = f"📩 קיבלתי: {user_message}"
    await update.message.reply_text(response)

async def help_command(update, context):
    """פקודת /help"""
    help_text = """
🤖 הפקודות הזמינות:
/start - התחלת שיחה עם הבוט
/help - הצגת הודעת עזרה זו

פשוט שלח לי הודעה ואני אחזיר אותה אליך!
    """
    await update.message.reply_text(help_text)

# ===== חלק 3: הפעלת הבוט =====
def main():
    """הפונקציה הראשית"""
    
    # בדיקה שהטוקן קיים
    bot_token = os.getenv('BOT_TOKEN')
    if not bot_token:
        print("❌ שגיאה: BOT_TOKEN לא נמצא במשתני הסביבה!")
        return
    
    # הפעלת שרת Keep-Alive ב-thread נפרד
    print("🚀 מפעיל שרת Keep-Alive...")
    flask_thread = Thread(target=run_flask, daemon=True)
    flask_thread.start()
    
    # בניית הבוט
    print("🤖 בונה את הבוט...")
    application = Application.builder().token(bot_token).build()
    
    # הוספת פקודות ומטפלי הודעות
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo))
    
    # הפעלת הבוט במצב Polling
    print("✅ הבוט מתחיל לפעול...")
    application.run_polling(drop_pending_updates=True)

if __name__ == '__main__':
    main()</pre>
                            </div>
                        </div>

                        <div class="tip-box">
                            <h4>🔍 הסבר על כל חלק:</h4>
                            <ul>
                                <li><strong>שרת Flask:</strong> פותח פורט לבדיקות Render</li>
                                <li><strong>Thread נפרד:</strong> השרת רץ במקביל לבוט, לא חוסם אותו</li>
                                <li><strong>routes שימושיים:</strong> `/` לבדיקה בסיסית, `/status` למידע נוסף</li>
                                <li><strong>בדיקת טוקן:</strong> מוודא שהמפתח קיים לפני הפעלה</li>
                                <li><strong>drop_pending_updates:</strong> מתעלם מהודעות שהצטברו בזמן עצירה</li>
                            </ul>
                        </div>
                    </div>

                    <div class="topic" id="docker">
                        <h3>Dockerfile - מה זה ולמה צריך?</h3>
                        
                        <div class="info-box">
                            <h4>🐳 מה זה Docker ו-Dockerfile?</h4>
                            <p><strong>Docker</strong> זה כמו "מכונה וירטואלית קטנה" שמאפשרת להריץ את הבוט שלך בסביבה זהה בכל מקום.</p>
                            <p><strong>Dockerfile</strong> זה "מתכון" שמגדיר איך לבנות את הסביבה הזו - איזה מערכת הפעלה, איזה תוכנות להתקין, ואיך להריץ את הבוט.</p>
                        </div>

                        <div class="success-box">
                            <h4>🎯 למה זה שימושי?</h4>
                            <ul>
                                <li><strong>עובד בכל מקום:</strong> מה שרץ אצלך במחשב ירוץ גם ב-Render</li>
                                <li><strong>סביבה נקייה:</strong> הבוט רץ עם רק מה שהוא צריך</li>
                                <li><strong>ללא בעיות תלויות:</strong> אין קונפליקטים עם ספריות אחרות</li>
                                <li><strong>פריסה מהירה:</strong> Render יודע בדיוק מה לעשות</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ האם בהכרח צריך Dockerfile?</h4>
                            <p><strong>לא תמיד!</strong> Render יכול לרוץ גם בלי Dockerfile, אבל:</p>
                            <ul>
                                <li>עם Dockerfile - יותר שליטה ופחות בעיות</li>
                                <li>בלי Dockerfile - פשוט יותר אבל יותר מגבלות</li>
                            </ul>
                            <p>למתחילים: מומלץ להתחיל <strong>בלי</strong> Dockerfile ולהוסיף אותו מאוחר יותר.</p>
                        </div>

                        <div class="subtopic">
                            <h4>איפה ליצור את הקובץ:</h4>
                            <div class="success-box">
                                <h5>📁 מבנה התיקיות עם Dockerfile:</h5>
                                <div class="code-block">
                                    <pre>my-telegram-bot/
├── main.py          ← הקוד של הבוט
├── requirements.txt ← רשימת הספריות
├── Dockerfile       ← הקובץ החדש (ללא סיומת!)
└── .env            ← מפתחות (מקומי בלבד)</pre>
                                </div>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>תוכן הקובץ עם הסבר:</h4>
                            <div class="code-block">
                                <h5>📄 Dockerfile מלא:</h5>
                                <pre># 1. בחירת מערכת הפעלה בסיסית
FROM python:3.10-slim

# 2. הגדרת תיקיית עבודה בתוך הקונטיינר
WORKDIR /app

# 3. העתקת רשימת הספריות קודם (לזיכרון מטמון טוב יותר)
COPY requirements.txt .

# 4. התקנת כל הספריות
RUN pip install --no-cache-dir -r requirements.txt

# 5. העתקת כל הקוד לקונטיינר
COPY . .

# 6. הגדרת הפורט שהאפליקציה תשתמש בו
EXPOSE 5000

# 7. פקודת הפעלה (חשוב: ללא סוגריים!)
CMD python main.py</pre>
                            </div>
                            
                            <div class="tip-box">
                                <h5>📝 הסבר שורה אחר שורה:</h5>
                                <ul>
                                    <li><strong>FROM python:3.10-slim:</strong> מתחיל עם מערכת לינוקס קטנה ופייתון מותקן</li>
                                    <li><strong>WORKDIR /app:</strong> כל הקבצים יהיו בתיקייה /app</li>
                                    <li><strong>COPY requirements.txt:</strong> מעתיק קודם רק את רשימת הספריות</li>
                                    <li><strong>RUN pip install:</strong> מתקין את הספריות</li>
                                    <li><strong>COPY . .:</strong> מעתיק את כל שאר הקבצים</li>
                                    <li><strong>EXPOSE 5000:</strong> מגדיר איזה פורט השרת יפתח</li>
                                    <li><strong>CMD python main.py:</strong> מריץ את הבוט</li>
                                </ul>
                            </div>
                        </div>

                        <div class="error-item">
                            <h5>❌ הטעות הנפוצה עם CMD:</h5>
                            <div class="code-block">
                                <pre># ❌ לא יעבוד עם משתני סביבה כמו $PORT
CMD ["python", "main.py"]</pre>
                            </div>
                            <div class="solution">
                                <h5>✅ הדרך הנכונה:</h5>
                                <div class="code-block">
                                    <pre># ✅ יעבוד עם משתני סביבה
CMD python main.py</pre>
                                </div>
                                <p><strong>למה?</strong> הפורמט עם סוגריים מרובעים (exec form) לא מתרגם משתני סביבה. הפורמט ללא סוגריים (shell form) כן מתרגם אותם.</p>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h4>🔄 מתי להשתמש ומתי לא:</h4>
                            <table style="width: 100%; margin: 10px 0;">
                                <tr>
                                    <th>השתמש ב-Dockerfile כאשר:</th>
                                    <th>אל תשתמש אם:</th>
                                </tr>
                                <tr>
                                    <td>✅ צריך תוכנות נוספות (tesseract, ffmpeg)</td>
                                    <td>❌ זה הבוט הראשון שלך</td>
                                </tr>
                                <tr>
                                    <td>✅ יש בעיות עם גרסאות Python</td>
                                    <td>❌ הכל עובד בלי זה</td>
                                </tr>
                                <tr>
                                    <td>✅ צריך הגדרות מערכת מיוחדות</td>
                                    <td>❌ רוצה פתרון פשוט ומהיר</td>
                                </tr>
                                <tr>
                                    <td>✅ הבוט מורכב עם הרבה תלויות</td>
                                    <td>❌ אין ניסיון עם Docker</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="topic" id="render">
                        <h3>הגדרת Render - שתי דרכים</h3>
                        
                        <div class="info-box">
                            <h4>🔧 שתי דרכים להגדיר שירות ב-Render:</h4>
                            <ol>
                                <li><strong>דרך הממשק</strong> - פשוט ונוח למתחילים</li>
                                <li><strong>קובץ render.yaml</strong> - מתקדם ומדויק יותר</li>
                            </ol>
                            <p><strong>המלצה למתחילים:</strong> תתחיל עם הממשק, ומאוחר יותר תעבור לקובץ.</p>
                        </div>

                        <div class="subtopic">
                            <h4>דרך 1: הגדרה דרך הממשק (מומלץ למתחילים)</h4>
                            <ol>
                                <li><strong>לך ל-Render Dashboard</strong></li>
                                <li><strong>לחץ "New +"</strong> ← <strong>"Web Service"</strong></li>
                                <li><strong>בחר את המאגר שלך מ-GitHub</strong></li>
                                <li><strong>מלא את השדות:</strong>
                                    <ul>
                                        <li><strong>Name:</strong> שם לבחירתך (באנגלית) - למשל: <code>my-telegram-bot</code></li>
                                        <li><strong>Build Command:</strong> <code>pip install -r requirements.txt</code></li>
                                        <li><strong>Start Command:</strong> <code>python main.py</code></li>
                                    </ul>
                                </li>
                                <li><strong>לחץ "Create Web Service"</strong></li>
                            </ol>
                        </div>

                        <div class="subtopic">
                            <h4>דרך 2: קובץ render.yaml (למתקדמים)</h4>
                            
                            <div class="warning-box">
                                <h5>🤔 מה זה render.yaml?</h5>
                                <p>קובץ הגדרות שמגדיר ל-Render את כל פרטי השירות שלך. במקום למלא טופס בממשק, אתה כותב את ההגדרות בקובץ.</p>
                                <p><strong>יתרונות:</strong> שליטה מלאה, אפשר לשמור את ההגדרות ב-Git, קל לשכפל שירותים.</p>
                            </div>

                            <div class="success-box">
                                <h5>📁 איפה ליצור את הקובץ:</h5>
                                <div class="code-block">
                                    <pre>my-telegram-bot/
├── main.py
├── requirements.txt
├── render.yaml      ← הקובץ החדש (בתיקייה הראשית!)
└── .env</pre>
                                </div>
                                <p><strong>חשוב:</strong> הקובץ חייב להיות בתיקייה הראשית של הפרויקט, עם השם המדויק <code>render.yaml</code></p>
                            </div>

                            <div class="code-block">
                                <h5>📄 תוכן קובץ render.yaml עם הסבר מלא:</h5>
                                <pre># הגדרת השירותים (יכול להיות יותר מאחד)
services:
  # הגדרת שירות יחיד
  - type: web                          # סוג השירות - web = אתר/API
    name: my-telegram-bot              # שם השירות (באנגלית)
    env: python                        # סביבת הפעלה
    plan: free                         # תוכנית תשלום (free/starter/standard)
    
    # פקודות בנייה והפעלה
    buildCommand: "pip install -r requirements.txt"  # מה לעשות בזמן בנייה
    startCommand: "python main.py"                   # איך להפעיל את האפליקציה
    
    # הגדרות Keep-Alive
    healthCheckPath: /                 # איזה נתיב לבדוק לזמינות (קריטי!)
    
    # משתני סביבה (לא רגישים)
    envVars:
      - key: PYTHON_VERSION
        value: "3.10.6"              # גרסת פייתון מועדפת
      - key: ENVIRONMENT 
        value: "production"          # סביבת הפעלה
    
    # דיסק קשיח קבוע (אם צריך לשמור קבצים)
    disks:
      - name: bot-storage            # שם הדיסק
        mountPath: /var/data         # איפה הוא יהיה זמין בקוד
        sizeGB: 1                    # גודל בגיגה (1GB חינם)</pre>
                            </div>
                            
                            <div class="tip-box">
                                <h5>📝 הסבר כל שדה:</h5>
                                <ul>
                                    <li><strong>type: web</strong> - נדרש עבור התוכנית החינמית</li>
                                    <li><strong>name</strong> - יהפוך לכתובת: https://your-name.onrender.com</li>
                                    <li><strong>env: python</strong> - אומר ל-Render שזו אפליקציית Python</li>
                                    <li><strong>buildCommand</strong> - מה לעשות כדי להכין את האפליקציה</li>
                                    <li><strong>startCommand</strong> - איך להריץ את האפליקציה</li>
                                    <li><strong>healthCheckPath: /</strong> - נתיב לבדיקת זמינות (חיוני לKeep-Alive!)</li>
                                    <li><strong>envVars</strong> - משתני סביבה שלא מכילים מידע רגיש</li>
                                    <li><strong>disks</strong> - אחסון קבוע לקבצים שצריכים להישמר</li>
                                </ul>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ מידע רגיש לא ב-render.yaml!</h4>
                            <p>מפתחות API, טוקנים וסיסמאות <strong>לא</strong> שמים ב-render.yaml כי הקובץ הזה נשמר ב-GitHub ציבורי.</p>
                            <p><strong>במקום זה:</strong> השתמש ב-Secret Files בממשק Render עבור <code>BOT_TOKEN</code>, <code>MONGO_URI</code> וכו'.</p>
                        </div>

                        <div class="subtopic">
                            <h4>איך Render קורא את הקובץ:</h4>
                            <ol>
                                <li>אתה עושה push לקובץ render.yaml ל-GitHub</li>
                                <li>ב-Render, תלחץ "New +" ← "Web Service"</li>
                                <li>תבחר את המאגר שלך</li>
                                <li>Render יזהה את הקובץ אוטומטית ויטען את ההגדרות</li>
                                <li>תוכל לעדכן פרטים נוספים בממשק אם צריך</li>
                            </ol>
                        </div>

                        <div class="tip-box">
                            <h4>💡 איזה דרך לבחור?</h4>
                            <ul>
                                <li><strong>מתחיל:</strong> התחל עם הממשק, זה יותר פשוט</li>
                                <li><strong>יש לך כמה בוטים:</strong> render.yaml יחסוך זמן</li>
                                <li><strong>עובד בצוות:</strong> render.yaml מאפשר לחלוק הגדרות</li>
                                <li><strong>צריך הגדרות מורכבות:</strong> render.yaml נותן יותר שליטה</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- חלק ג': נתונים ואחסון -->
            <div class="section">
                <div class="section-header data">
                    <h2>💾 חלק ג': נתונים ואחסון</h2>
                    <div class="level-indicator">
                        <span class="badge intermediate">בינוני</span>
                        <div class="level-dot"></div>
                        <div class="level-dot intermediate active"></div>
                        <div class="level-dot"></div>
                    </div>
                </div>
                <div class="section-content">
                    <div class="topic" id="advanced-mongodb">
                        <h3>שימוש מתקדם ב-MongoDB - עבר החיבור הבסיסי</h3>
                        
                        <div class="info-box">
                            <h4>💡 נניח שכבר הגדרת את MongoDB Atlas בחלק ההכנות</h4>
                            <p>כאן נלמד איך להשתמש בו בצורה חכמה ויעילה עבור הבוט שלך.</p>
                        </div>

                        <div class="subtopic">
                            <h4>מבנה נתונים מומלץ לבוט טלגרם:</h4>
                            <div class="code-block">
                                <h5>📊 Collections (טבלאות) מומלצות:</h5>
                                <pre># משתמשים - רשומה לכל משתמש
users = {
    "user_id": 123456789,          # ID ייחודי מטלגרם
    "username": "user123",         # שם משתמש (אם יש)
    "first_name": "יוסי",          # שם פרטי
    "language_code": "he",         # שפה מועדפת
    "is_active": true,             # האם המשתמש פעיל
    "first_join": "2024-01-15",    # מתי הצטרף
    "last_seen": "2024-01-20",     # פעילות אחרונה
    "total_messages": 47,          # כמה הודעות שלח
    "preferences": {               # העדפות אישיות
        "notifications": true,
        "favorite_topics": ["tech", "news"]
    }
}

# שיחות - רשומה לכל שיחה חשובה
conversations = {
    "user_id": 123456789,
    "timestamp": "2024-01-20T10:30:00",
    "message_type": "question",
    "content": "איך להתקין Python?",
    "bot_response": "כדי להתקין Python...",
    "satisfaction": 5              # דירוג של המשתמש
}

# תוכן הבוט - מידע שהבוט מחזיק
content = {
    "type": "faq",                 # סוג התוכן
    "question": "מה זה GitHub?",
    "answer": "GitHub הוא...",
    "tags": ["programming", "git"],
    "popularity": 42,              # כמה פעמים נשאל
    "last_updated": "2024-01-15"
}</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>פונקציות עזר למסד הנתונים:</h4>
                            <div class="code-block">
                                <h5>📚 מחלקה לניהול נתונים:</h5>
                                <pre>from pymongo import MongoClient
from datetime import datetime, timedelta
import os

class BotDatabase:
    def __init__(self):
        self.client = MongoClient(os.getenv('MONGO_URI'))
        self.db = self.client.telegram_bot
        self.users = self.db.users
        self.conversations = self.db.conversations
        self.content = self.db.content
    
    def register_user(self, user_data):
        """רישום משתמש חדש או עדכון קיים"""
        return self.users.update_one(
            {"user_id": user_data["user_id"]},
            {
                "$set": {
                    "user_id": user_data["user_id"],
                    "username": user_data.get("username"),
                    "first_name": user_data.get("first_name"),
                    "last_seen": datetime.now(),
                    "is_active": True
                },
                "$setOnInsert": {
                    "first_join": datetime.now(),
                    "total_messages": 0,
                    "preferences": {}
                },
                "$inc": {"total_messages": 1}
            },
            upsert=True
        )
    
    def log_conversation(self, user_id, message, bot_response):
        """שמירת שיחה"""
        self.conversations.insert_one({
            "user_id": user_id,
            "timestamp": datetime.now(),
            "message": message,
            "bot_response": bot_response
        })
    
    def get_user_stats(self, user_id):
        """סטטיסטיקות משתמש"""
        user = self.users.find_one({"user_id": user_id})
        if not user:
            return None
        
        # כמה שיחות יש למשתמש
        conversations_count = self.conversations.count_documents({"user_id": user_id})
        
        return {
            "first_join": user["first_join"],
            "total_messages": user["total_messages"],
            "conversations_count": conversations_count,
            "last_seen": user["last_seen"]
        }
    
    def get_popular_content(self, limit=10):
        """תוכן הכי פופולרי"""
        return list(self.content.find().sort("popularity", -1).limit(limit))

# שימוש במחלקה
db = BotDatabase()</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שימוש בפועל עם הבוט:</h4>
                            <div class="code-block">
                                <h5>🔗 שילוב עם פונקציות הבוט:</h5>
                                <pre>async def enhanced_start(update, context):
    """פקודת start משופרת עם מסד נתונים"""
    user = update.effective_user
    
    # רישום המשתמש
    db.register_user({
        "user_id": user.id,
        "username": user.username,
        "first_name": user.first_name,
        "language_code": user.language_code
    })
    
    # בדיקה אם זה משתמש חדש
    user_stats = db.get_user_stats(user.id)
    messages_count = user_stats["total_messages"]
    
    if messages_count == 1:
        welcome_msg = f"ברוך הבא {user.first_name}! 🎉\nזו הפעם הראשונה שלך כאן."
    else:
        welcome_msg = f"שלום שוב {user.first_name}! 👋\nזו הודעה מספר {messages_count} שלך."
    
    # שמירת השיחה
    db.log_conversation(user.id, "/start", welcome_msg)
    
    await update.message.reply_text(welcome_msg)

async def enhanced_echo(update, context):
    """הדהוד משופר עם שמירה במסד נתונים"""
    user = update.effective_user
    message = update.message.text
    
    # רישום המשתמש (מעדכן last_seen ו-total_messages)
    db.register_user({"user_id": user.id, "first_name": user.first_name})
    
    response = f"קיבלתי: {message}"
    
    # שמירת השיחה
    db.log_conversation(user.id, message, response)
    
    await update.message.reply_text(response)</pre>
                            </div>
                        </div>
                    </div>

                    <div class="topic" id="admin">
                        <h3>פקודות Admin מתקדמות עם מסד נתונים</h3>
                        
                        <div class="info-box">
                            <h4>👑 למה צריך פקודות Admin?</h4>
                            <p>כבעלים של הבוט, אתה צריך כלים לנהל אותו ולעקוב אחר הביצועים שלו:</p>
                            <ul>
                                <li><strong>סטטיסטיקות:</strong> כמה משתמשים, איזה תכונות פופולריות</li>
                                <li><strong>שידורים:</strong> שליחת הודעות לכל המשתמשים</li>
                                <li><strong>ניהול תוכן:</strong> הוספה/עדכון של מידע</li>
                                <li><strong>תחזוקה:</strong> ריבניית אינדקסים, ניקוי נתונים</li>
                            </ul>
                        </div>

                        <div class="subtopic">
                            <h4>הגדרת בקרת גישה:</h4>
                            <div class="code-block">
                                <h5>🔐 מערכת הרשאות פשוטה ויעילה:</h5>
                                <pre>import os
from functools import wraps

# הגדרת מנהלים (יכול להיות יותר מאחד)
ADMIN_IDS = [
    int(os.getenv('ADMIN_ID')),           # המנהל הראשי
    int(os.getenv('SECONDARY_ADMIN_ID', 0))  # מנהל משני (אופציונלי)
]

def admin_only(func):
    """דקורטור שמאפשר גישה רק למנהלים"""
    @wraps(func)
    async def wrapper(update, context):
        user_id = update.effective_user.id
        
        if user_id not in ADMIN_IDS:
            await update.message.reply_text(
                "⛔ פקודה זו זמינה רק למנהלי הבוט\n"
                f"המזהה שלך: {user_id}"
            )
            return
        
        # רישום השימוש בפקודת מנהל
        print(f"Admin command used: {func.__name__} by {user_id}")
        return await func(update, context)
    
    return wrapper

def super_admin_only(func):
    """דקורטור לפקודות מנהל ראשי בלבד"""
    @wraps(func)
    async def wrapper(update, context):
        user_id = update.effective_user.id
        main_admin = ADMIN_IDS[0]
        
        if user_id != main_admin:
            await update.message.reply_text("⛔ פקודה זו זמינה רק למנהל הראשי")
            return
        
        return await func(update, context)
    
    return wrapper</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>פקודות סטטיסטיקות מתקדמות:</h4>
                            <div class="code-block">
                                <h5>📊 מידע מקיף על הבוט:</h5>
                                <pre>@admin_only
async def advanced_stats(update, context):
    """סטטיסטיקות מפורטות של הבוט"""
    
    # נתונים בסיסיים
    total_users = db.users.count_documents({})
    
    # פעילות אחרונה
    today = datetime.now().replace(hour=0, minute=0, second=0)
    week_ago = datetime.now() - timedelta(days=7)
    
    active_today = db.users.count_documents({"last_seen": {"$gte": today}})
    active_this_week = db.users.count_documents({"last_seen": {"$gte": week_ago}})
    
    # משתמשים חדשים
    new_today = db.users.count_documents({"first_join": {"$gte": today}})
    new_this_week = db.users.count_documents({"first_join": {"$gte": week_ago}})
    
    # סה"כ שיחות
    total_conversations = db.conversations.count_documents({})
    conversations_today = db.conversations.count_documents({"timestamp": {"$gte": today}})
    
    # תוכן פופולרי
    popular_content = db.get_popular_content(5)
    
    stats_text = f"""
📊 **סטטיסטיקות הבוט** 📊

👥 **משתמשים:**
   • סה"כ משתמשים: {total_users:,}
   • פעילים היום: {active_today}
   • פעילים השבוע: {active_this_week}

🆕 **משתמשים חדשים:**
   • הצטרפו היום: {new_today}
   • הצטרפו השבוע: {new_this_week}

💬 **שיחות:**
   • סה"כ שיחות: {total_conversations:,}
   • שיחות היום: {conversations_today}

🔥 **תוכן פופולרי:**
"""
    
    for i, content in enumerate(popular_content, 1):
        stats_text += f"   {i}. {content.get('question', 'N/A')} ({content.get('popularity', 0)} צפיות)\n"
    
    await update.message.reply_text(stats_text, parse_mode='Markdown')

# הוספה למטפלי הפקודות
application.add_handler(CommandHandler("stats", advanced_stats))</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שידור הודעות מתקדם:</h4>
                            <div class="code-block">
                                <h5>📢 שליחה חכמה לקבוצות משתמשים:</h5>
                                <pre>@admin_only
async def smart_broadcast(update, context):
    """שידור עם אפשרויות מתקדמות"""
    if len(context.args) < 2:
        help_text = """
📢 **שימוש בפקודת שידור:**

/broadcast all הודעה... - לכל המשתמשים
/broadcast active הודעה... - רק למשתמשים פעילים השבוע
/broadcast new הודעה... - רק למשתמשים שהצטרפו השבוע

**דוגמה:**
/broadcast active שלום לכל המשתמשים הפעילים! 👋
        """
        await update.message.reply_text(help_text, parse_mode='Markdown')
        return
    
    target_group = context.args[0]
    message = " ".join(context.args[1:])
    
    # בחירת קבוצת המשתמשים לפי הפרמטר
    if target_group == "all":
        users_cursor = db.users.find({"is_active": True})
        group_name = "כל המשתמשים"
    elif target_group == "active":
        week_ago = datetime.now() - timedelta(days=7)
        users_cursor = db.users.find({"last_seen": {"$gte": week_ago}})
        group_name = "משתמשים פעילים השבוע"
    elif target_group == "new":
        week_ago = datetime.now() - timedelta(days=7)
        users_cursor = db.users.find({"first_join": {"$gte": week_ago}})
        group_name = "משתמשים חדשים השבוע"
    else:
        await update.message.reply_text("❌ קבוצת משתמשים לא מוכרת. השתמש ב: all/active/new")
        return
    
    # שליחה לכל המשתמשים ברשימה
    sent_count = 0
    failed_count = 0
    
    await update.message.reply_text(f"📤 מתחיל שידור ל{group_name}...")
    
    async for user in users_cursor:
        try:
            await context.bot.send_message(user["user_id"], message)
            sent_count += 1
            
            # הפסקה קטנה כדי לא לעמוס על טלגרם
            if sent_count % 20 == 0:
                await asyncio.sleep(1)
                
        except Exception as e:
            failed_count += 1
            # המשתמש חסם את הבוט או מחק את החשבון
            if "blocked" in str(e).lower():
                db.users.update_one(
                    {"user_id": user["user_id"]},
                    {"$set": {"is_active": False}}
                )
    
    result_text = f"""
✅ **שידור הושלם!**

📊 **תוצאות:**
   • נשלח בהצלחה: {sent_count}
   • נכשל: {failed_count}
   • קבוצת יעד: {group_name}

📝 **ההודעה שנשלחה:**
{message}
    """
    
    await update.message.reply_text(result_text, parse_mode='Markdown')</pre>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ חשוב לזכור:</h4>
                            <ul>
                                <li><strong>אל תשכח את ADMIN_ID:</strong> הוסף את המזהה שלך למשתני הסביבה</li>
                                <li><strong>הגבל שידורים:</strong> אל תשלח יותר מדי הודעות ביום</li>
                                <li><strong>כבד את המשתמשים:</strong> תן אפשרות להסיר עצמם מהרשימה</li>
                                <li><strong>שמור לוגים:</strong> תעד פעולות מנהל לבדיקה מאוחר יותר</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- חלק ד': תכונות מתקדמות -->
            <div class="section">
                <div class="section-header advanced">
                    <h2>⚡ חלק ד': תכונות מתקדמות</h2>
                    <div class="level-indicator">
                        <span class="badge advanced">מתקדם</span>
                        <div class="level-dot"></div>
                        <div class="level-dot"></div>
                        <div class="level-dot advanced active"></div>
                    </div>
                </div>
                <div class="section-content">
                    <div class="topic" id="api">
                        <h3>חיבור ל-API חיצוני - מעיון ועד AI</h3>
                        
                        <div class="info-box">
                            <h4>🌐 מה זה API ולמה הבוט צריך אותו?</h4>
                            <p><strong>API</strong> (Application Programming Interface) זה דרך לתוכנות לדבר אחת עם השנייה.</p>
                            <p>הבוט שלך יכול להתחבר לשירותים חיצוניים כדי:</p>
                            <ul>
                                <li><strong>לקבל מידע:</strong> חדשות, מזג אויר, מחירי מניות</li>
                                <li><strong>לעבד תוכן:</strong> תרגום, זיהוי תמונות, סיכום טקסט</li>
                                <li><strong>להשתמש ב-AI:</strong> ChatGPT, Claude, Gemini, תמונות מ-DALL-E</li>
                                <li><strong>לשלוח הודעות:</strong> אימיילים, SMS, התראות</li>
                            </ul>
                        </div>

                        <div class="subtopic">
                            <h4>השגת מפתחות API פופולריים:</h4>
                            
                            <div class="success-box">
                                <h5>🤖 OpenAI (ChatGPT, DALL-E):</h5>
                                <ol>
                                    <li>לך ל-<a href="https://platform.openai.com/" target="_blank">platform.openai.com</a></li>
                                    <li>הירשם/התחבר לחשבון</li>
                                    <li>לחץ על שמך ← "View API Keys"</li>
                                    <li>לחץ "Create new secret key"</li>
                                    <li>תן שם למפתח: "telegram-bot"</li>
                                    <li>העתק את המפתח (מתחיל ב-<code>sk-</code>)</li>
                                </ol>
                                <p><strong>עלויות:</strong> $5 זיכוי התחלתי, אחר כך תשלום לפי שימוש</p>
                            </div>

                            <div class="success-box">
                                <h5>💎 Google Gemini:</h5>
                                <ol>
                                    <li>לך ל-<a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></li>
                                    <li>התחבר עם חשבון Google</li>
                                    <li>לחץ "Create API Key"</li>
                                    <li>בחר פרויקט Google Cloud (או צור חדש)</li>
                                    <li>העתק את המפתח (מתחיל ב-<code>AIzaSy</code>)</li>
                                </ol>
                                <p><strong>עלויות:</strong> יש מכסה חינמית נדיבה</p>
                            </div>

                            <div class="success-box">
                                <h5>🌤️ OpenWeatherMap (מזג אויר):</h5>
                                <ol>
                                    <li>לך ל-<a href="https://openweathermap.org/api" target="_blank">openweathermap.org</a></li>
                                    <li>לחץ "Sign Up" והירשם</li>
                                    <li>אמת את האימייל</li>
                                    <li>לך ל-"My API Keys"</li>
                                    <li>המפתח כבר חיכה לך!</li>
                                </ol>
                                <p><strong>עלויות:</strong> 1000 קריאות ביום חינם</p>
                            </div>

                            <div class="success-box">
                                <h5>📰 NewsAPI (חדשות):</h5>
                                <ol>
                                    <li>לך ל-<a href="https://newsapi.org/" target="_blank">newsapi.org</a></li>
                                    <li>לחץ "Get API Key" והירשם</li>
                                    <li>מלא פרטים (שם, אימייל, סיסמה)</li>
                                    <li>בחר "Developer" בתור סוג החשבון</li>
                                    <li>המפתח יישלח באימייל</li>
                                </ol>
                                <p><strong>עלויות:</strong> 100 קריאות ביום חינם</p>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>פתרון שגיאת 403 Forbidden:</h4>
                            
                            <div class="warning-box">
                                <h5>🚫 הבעיה הנפוצה:</h5>
                                <p>הרבה אתרים חוסמים "בוטים" ורואים שהבקשה לא מגיעה מדפדפן אמיתי. אז הם מחזירים שגיאת 403 Forbidden.</p>
                            </div>

                            <div class="code-block">
                                <h5>✅ הפתרון - הוספת Headers:</h5>
                                <pre>import requests

# כותרות שגורמות לבקשה להיראות כמו דפדפן
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    'Accept': 'application/json, text/plain, */*',
    'Accept-Language': 'he-IL,he;q=0.9,en;q=0.8',
    'Accept-Encoding': 'gzip, deflate, br',
    'DNT': '1',
    'Connection': 'keep-alive',
    'Upgrade-Insecure-Requests': '1',
}

def fetch_external_data(url):
    """פונקציה כללית לקריאת נתונים מAPI חיצוני"""
    try:
        response = requests.get(url, headers=headers, timeout=10)
        response.raise_for_status()  # יזרוק שגיאה אם הסטטוס לא 200
        return response.json()
    except requests.RequestException as e:
        print(f"שגיאה בקריאת API: {e}")
        return None</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>דוגמה מלאה - בוט מזג אויר:</h4>
                            <div class="code-block">
                                <h5>שימוש ב-OpenWeatherMap API:</h5>
                                <pre>import requests
import os

async def weather_command(update, context):
    """פקודת /weather עם שם עיר"""
    if not context.args:
        await update.message.reply_text("שימוש: /weather [שם עיר]\nדוגמה: /weather תל אביב")
        return
    
    city = " ".join(context.args)
    api_key = os.getenv('WEATHER_API_KEY')
    
    # בניית ה-URL
    url = f"http://api.openweathermap.org/data/2.5/weather"
    params = {
        'q': city,
        'appid': api_key,
        'units': 'metric',  # צלזיוס
        'lang': 'he'        # תרגום לעברית
    }
    
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
    }
    
    try:
        response = requests.get(url, params=params, headers=headers, timeout=10)
        response.raise_for_status()
        data = response.json()
        
        # עיבוד הנתונים
        temp = data['main']['temp']
        feels_like = data['main']['feels_like']
        description = data['weather'][0]['description']
        humidity = data['main']['humidity']
        
        weather_text = f"""
🌤️ מזג האויר ב{city}:
🌡️ טמפרטורה: {temp}°C (מרגיש כמו {feels_like}°C)
☁️ תיאור: {description}
💧 לחות: {humidity}%
        """
        
        await update.message.reply_text(weather_text)
        
    except requests.RequestException as e:
        await update.message.reply_text(f"שגיאה בקבלת נתוני מזג האויר: {e}")
    except KeyError:
        await update.message.reply_text("עיר לא נמצאה. בדוק את השם ונסה שוב.")</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>דוגמה מתקדמת - שימוש ב-AI:</h4>
                            <div class="code-block">
                                <h5>שילוב OpenAI GPT בבוט:</h5>
                                <pre>import openai
import os

# הגדרת המפתח
openai.api_key = os.getenv('OPENAI_API_KEY')

async def ask_ai_command(update, context):
    """פקודת /ask עם שאלה ל-AI"""
    if not context.args:
        await update.message.reply_text("שימוש: /ask [השאלה שלך]\nדוגמה: /ask מה זה בינה מלאכותית?")
        return
    
    question = " ".join(context.args)
    user_name = update.effective_user.first_name
    
    # הודעת המתנה
    await update.message.reply_text("🤔 חושב על התשובה...")
    
    try:
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {
                    "role": "system", 
                    "content": "אתה עוזר ידידותי ומועיל. תענה בעברית בצורה קצרה וברורה."
                },
                {
                    "role": "user", 
                    "content": f"{user_name} שואל: {question}"
                }
            ],
            max_tokens=500,
            temperature=0.7
        )
        
        ai_answer = response.choices[0].message.content
        await update.message.reply_text(f"🤖 {ai_answer}")
        
    except Exception as e:
        await update.message.reply_text(f"שגיאה בפנייה ל-AI: {e}")

# הוספה למטפלי הפקודות
application.add_handler(CommandHandler("ask", ask_ai_command))</pre>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ שימו לב לעלויות!</h4>
                            <ul>
                                <li><strong>AI APIs עולים כסף</strong> - עקבו אחר השימוש</li>
                                <li><strong>הגדירו מגבלות</strong> בחשבון API למניעת הפתעות</li>
                                <li><strong>השתמשו בcaching</strong> - אל תשאלו שוב את אותה שאלה</li>
                                <li><strong>הגבילו למספר קריאות ביום</strong> למשתמש</li>
                            </ul>
                        </div>

                        <div class="tip-box">
                            <h4>💡 טיפים לחיסכון:</h4>
                            <ul>
                                <li><strong>התחילו עם APIs חינמיים</strong> (מזג אויר, חדשות)</li>
                                <li><strong>הגבילו אורך התשובות</strong> ב-AI (max_tokens)</li>
                                <li><strong>השתמשו במודלים זולים</strong> (gpt-3.5-turbo במקום gpt-4)</li>
                                <li><strong>הוסיפו cooldown</strong> - משתמש יכול לשאול רק פעם בדקה</li>
                            </ul>
                        </div>
                    </div>

                    <div class="topic" id="hybrid-search">
                        <h3>חיפוש היברידי - איך לחסוך בעלויות AI</h3>
                        
                        <div class="warning-box">
                            <h4>💰 הבעיה עם AI יקר:</h4>
                            <p>שירותי AI כמו ChatGPT עולים כסף לפי כמות הטקסט שאתה שולח. אם הבוט שלך עונה על שאלות מתוך מאגר מידע גדול, שליחת כל המידע ל-AI בכל פעם תעלה הון!</p>
                            <p><strong>דוגמה:</strong> יש לך מאגר של 1000 מאמרים על תכנות. משתמש שואל "מה זה Python?" - אל תשלח את כל 1000 המאמרים ל-ChatGPT!</p>
                        </div>

                        <div class="info-box">
                            <h4>🧠 הרעיון של חיפוש היברידי:</h4>
                            <ol>
                                <li><strong>חיפוש מקומי מהיר</strong> - מצא 10-15 תוצאות הכי רלוונטיות</li>
                                <li><strong>שלח רק אותן ל-AI</strong> - לדירוג מדויק ומענה איכותי</li>
                                <li><strong>חסוך 90% מהעלויות</strong> - במקום 1000 מאמרים, שלח רק 10</li>
                            </ol>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 1: חיפוש מקומי פשוט וקל:</h4>
                            <div class="code-block">
                                <h5>🔍 חיפוש במילות מפתח:</h5>
                                <pre>def simple_search(query, articles_db, max_results=10):
    """חיפוש בסיסי במאגר המאמרים"""
    results = []
    query_words = query.lower().split()
    
    for article in articles_db:
        score = 0
        article_text = (article['title'] + ' ' + article['content']).lower()
        
        # נותן נקודות לכל מילה שנמצאת
        for word in query_words:
            if word in article_text:
                score += 1
                # מילה בכותרת שווה יותר
                if word in article['title'].lower():
                    score += 2
        
        if score > 0:
            results.append({
                'article': article,
                'score': score,
                'relevance': score / len(query_words)  # אחוז התאמה
            })
    
    # מיון לפי ציון מהגבוה לנמוך
    results.sort(key=lambda x: x['score'], reverse=True)
    
    return results[:max_results]

# דוגמת שימוש
articles_database = [
    {"id": 1, "title": "מדריך Python למתחילים", "content": "Python זו שפת תכנות..."},
    {"id": 2, "title": "JavaScript בסיסי", "content": "JavaScript היא שפה..."},
    {"id": 3, "title": "מה זה GitHub", "content": "GitHub הוא שירות..."},
    # ... עוד מאמרים
]

# חיפוש שאלה
user_question = "מה זה Python"
top_articles = simple_search(user_question, articles_database, 5)</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 2: שליחה ל-AI לתשובה מדויקת:</h4>
                            <div class="code-block">
                                <h5>🤖 שילוב עם OpenAI:</h5>
                                <pre>import openai
import os

openai.api_key = os.getenv('OPENAI_API_KEY')

async def answer_with_ai(user_question, relevant_articles):
    """מעבד את המאמרים הרלוונטיים עם AI לתשובה מדויקת"""
    
    if not relevant_articles:
        return "מצטער, לא מצאתי מידע רלוונטי לשאלה שלך."
    
    # הכנת הטקסט לשליחה ל-AI
    context = "מידע רלוונטי מהמאגר:\n\n"
    for i, item in enumerate(relevant_articles, 1):
        article = item['article']
        context += f"{i}. כותרת: {article['title']}\n"
        context += f"   תוכן: {article['content'][:300]}...\n\n"  # רק 300 תווים ראשונים
    
    # בניית השאילתה ל-AI
    ai_prompt = f"""
על בסיס המידע הבא, ענה על השאלה של המשתמש בעברית בצורה ברורה וקצרה.

שאלת המשתמש: {user_question}

{context}

הוראות:
1. ענה רק על בסיס המידע שסופק
2. אם המידע לא מספיק, תגיד שאין מספיק מידע
3. תהיה קציר וברור
4. אל תמציא מידע שלא נמצא בטקסט
"""

    try:
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",  # המודל הזול יותר
            messages=[
                {"role": "system", "content": "אתה עוזר מידעני ברור ומדויק."},
                {"role": "user", "content": ai_prompt}
            ],
            max_tokens=300,  # הגבלת אורך התשובה = חיסכון בכסף
            temperature=0.3  # תשובות יציבות ומדויקות יותר
        )
        
        return response.choices[0].message.content
        
    except Exception as e:
        return f"שגיאה בפנייה ל-AI: {e}"

# פונקציה משולבת לבוט
async def smart_search_command(update, context):
    """פקודת /search עם חיפוש היברידי"""
    if not context.args:
        await update.message.reply_text("שימוש: /search [השאלה שלך]\nדוגמה: /search מה זה Python")
        return
    
    user_question = " ".join(context.args)
    
    # הודעת המתנה
    await update.message.reply_text("🔍 מחפש במאגר המידע...")
    
    # שלב 1: חיפוש מקומי
    relevant_articles = simple_search(user_question, articles_database, 5)
    
    if not relevant_articles:
        await update.message.reply_text("לא מצאתי מידע רלוונטי לשאלה שלך. נסה לנסח אחרת.")
        return
    
    # הודעת עדכון
    await update.message.reply_text(f"📚 מצאתי {len(relevant_articles)} מאמרים רלוונטיים, מעבד עם AI...")
    
    # שלב 2: עיבוד עם AI
    ai_answer = await answer_with_ai(user_question, relevant_articles)
    
    # שליחת התשובה
    await update.message.reply_text(f"🤖 **תשובה:**\n{ai_answer}", parse_mode='Markdown')</pre>
                            </div>
                        </div>

                        <div class="success-box">
                            <h4>💰 כמה כסף זה חוסך?</h4>
                            <p><strong>דוגמה מעשית:</strong></p>
                            <ul>
                                <li><strong>בלי חיפוש היברידי:</strong> 1000 מאמרים × 500 מילים = 500,000 מילים ל-AI = $10 לשאלה</li>
                                <li><strong>עם חיפוש היברידי:</strong> 5 מאמרים × 300 מילים = 1,500 מילים ל-AI = $0.03 לשאלה</li>
                                <li><strong>חיסכון:</strong> 99.7% פחות עלויות! 🎉</li>
                            </ul>
                        </div>

                        <div class="tip-box">
                            <h4>💡 טיפים לשיפור החיפוש:</h4>
                            <ul>
                                <li><strong>מילות עצר:</strong> הסר מילים כמו "מה", "איך", "זה" מהחיפוש</li>
                                <li><strong>חיפוש מתקדם:</strong> השתמש בספריות כמו whoosh או elasticsearch</li>
                                <li><strong>למידה:</strong> זכור איזה מאמרים המשתמש אהב ותן להם עדיפות</li>
                                <li><strong>תיוג:</strong> הוסף תגים למאמרים לחיפוש טוב יותר</li>
                            </ul>
                        </div>
                    </div>

                    <div class="topic" id="lazy-loading">
                        <h3>טעינה עצלה - איך לא לקרוס את השרת החינמי</h3>
                        
                        <div class="warning-box">
                            <h4>⚠️ הבעיה עם שרתים חינמיים:</h4>
                            <p>שירותי ענן חינמיים כמו Render נותנים רק 512MB זיכרון. מודלי AI גדולים יכולים "לאכול" 200-500MB בטעינה, מה שגורם לבוט להתנגש או לא להתחיל בכלל.</p>
                        </div>

                        <div class="info-box">
                            <h4>💡 מה זה "טעינה עצלה" (Lazy Loading)?</h4>
                            <p>במקום לטעון את כל המודלים הכבדים כשהבוט מתחיל, נטען אותם רק כשבאמת צריך אותם. כך הבוט עולה מהר וצורך פחות זיכרון.</p>
                        </div>

                        <div class="subtopic">
                            <h4>דוגמה לבעיה - מה לא לעשות:</h4>
                            <div class="code-block">
                                <h5>❌ קוד שיקרוס את השרת:</h5>
                                <pre># ❌ זה יטען הכל בהתחלה ויקרוס את השרת החינמי
import openai
import tensorflow as tf
from transformers import pipeline
import spacy

# טעינה מיידית של כל המודלים (רעיון גרוע!)
nlp_model = spacy.load("he_core_news_sm")  # 100MB
sentiment_analyzer = pipeline("sentiment-analysis")  # 250MB
translation_model = pipeline("translation")  # 300MB

def main():
    # הבוט יקרוס עוד לפני שמתחיל לרוץ!
    application.run_polling()</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>הפתרון - טעינה עצלה נכונה:</h4>
                            <div class="code-block">
                                <h5>✅ קוד שעובד בשרת חינמי:</h5>
                                <pre># ✅ טעינה עצלה - המודלים יטענו רק כשצריך
import openai
import os

# משתנים גלובליים שיכילו את המודלים (בהתחלה None)
nlp_model = None
sentiment_analyzer = None
translation_model = None

def load_nlp_model():
    """טוען מודל NLP רק כשקוראים לפונקציה"""
    global nlp_model
    if nlp_model is None:
        print("🔄 טוען מודל NLP...")
        import spacy
        nlp_model = spacy.load("he_core_news_sm")
        print("✅ מודל NLP נטען בהצלחה!")
    return nlp_model

def load_sentiment_analyzer():
    """טוען מודל ניתוח רגשות רק כשצריך"""
    global sentiment_analyzer
    if sentiment_analyzer is None:
        print("🔄 טוען מודל ניתוח רגשות...")
        from transformers import pipeline
        sentiment_analyzer = pipeline("sentiment-analysis")
        print("✅ מודל ניתוח רגשות נטען!")
    return sentiment_analyzer

def load_translation_model():
    """טוען מודל תרגום רק כשצריך"""
    global translation_model
    if translation_model is None:
        print("🔄 טוען מודל תרגום...")
        from transformers import pipeline
        translation_model = pipeline("translation", model="Helsinki-NLP/opus-mt-en-he")
        print("✅ מודל תרגום נטען!")
    return translation_model

# פקודות שטוענות מודלים רק כשצריך
@admin_only
async def analyze_sentiment_command(update, context):
    """פקודת /sentiment לניתוח רגשות"""
    if not context.args:
        await update.message.reply_text("שימוש: /sentiment [טקסט לניתוח]")
        return
    
    text = " ".join(context.args)
    
    try:
        # הודעת טעינה
        loading_msg = await update.message.reply_text("🔄 טוען מודל ניתוח רגשות...")
        
        # כאן נטען המודל רק אם עדיין לא נטען
        analyzer = load_sentiment_analyzer()
        
        # עדכון הודעה
        await loading_msg.edit_text("🧠 מנתח את הטקסט...")
        
        # ניתוח הטקסט
        result = analyzer(text)
        
        # הצגת התוצאות
        sentiment = result[0]['label']
        confidence = result[0]['score']
        
        result_text = f"""
📊 **ניתוח רגשות:**
📝 הטקסט: "{text}"
😊 רגש: {sentiment}
📈 ביטחון: {confidence:.2%}
        """
        
        await loading_msg.edit_text(result_text, parse_mode='Markdown')
        
    except Exception as e:
        await update.message.reply_text(f"❌ שגיאה בניתוח: {e}")

@admin_only
async def translate_command(update, context):
    """פקודת /translate לתרגום"""
    if not context.args:
        await update.message.reply_text("שימוש: /translate [טקסט באנגלית]")
        return
    
    text = " ".join(context.args)
    
    try:
        loading_msg = await update.message.reply_text("🔄 טוען מודל תרגום...")
        
        # טעינה עצלה של מודל התרגום
        translator = load_translation_model()
        
        await loading_msg.edit_text("🌐 מתרגם...")
        
        # תרגום הטקסט
        translation = translator(text)
        translated_text = translation[0]['translation_text']
        
        result_text = f"""
🌐 **תרגום:**
🇺🇸 מקור: "{text}"
🇮🇱 תרגום: "{translated_text}"
        """
        
        await loading_msg.edit_text(result_text, parse_mode='Markdown')
        
    except Exception as e:
        await update.message.reply_text(f"❌ שגיאה בתרגום: {e}")

def main():
    """הפונקציה הראשית - הבוט מתחיל מהר בלי לטעון מודלים"""
    print("🚀 מתחיל בוט...")
    
    # הבוט עולה מהר כי לא טוען שום מודל כבד!
    application = Application.builder().token(os.getenv('BOT_TOKEN')).build()
    
    # הוספת פקודות
    application.add_handler(CommandHandler("sentiment", analyze_sentiment_command))
    application.add_handler(CommandHandler("translate", translate_command))
    
    print("✅ הבוט פועל!")
    application.run_polling()</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>דוגמה מתקדמת - ניהול זיכרון חכם:</h4>
                            <div class="code-block">
                                <h5>🧠 שחרור מודלים כשלא צריך:</h5>
                                <pre>import gc
import psutil
from datetime import datetime, timedelta

# מחלקה לניהול מודלים חכם
class ModelManager:
    def __init__(self):
        self.models = {}
        self.last_used = {}
        self.max_memory_mb = 400  # מקסימום זיכרון לשימוש
    
    def get_memory_usage(self):
        """בדיקת צריכת זיכרון נוכחית"""
        process = psutil.Process()
        return process.memory_info().rss / 1024 / 1024  # MB
    
    def cleanup_unused_models(self, max_age_minutes=30):
        """ניקוי מודלים שלא נעשה בהם שימוש"""
        current_time = datetime.now()
        
        for model_name in list(self.models.keys()):
            last_used = self.last_used.get(model_name, current_time)
            age = current_time - last_used
            
            if age > timedelta(minutes=max_age_minutes):
                print(f"🗑️ משחרר מודל {model_name} (לא בשימוש {age.total_seconds()//60:.0f} דקות)")
                del self.models[model_name]
                del self.last_used[model_name]
                gc.collect()  # ניקוי זיכרון מיידי
    
    def load_model(self, model_name, loader_func):
        """טעינת מודל עם ניהול זיכרון"""
        # בדיקת זיכרון לפני טעינה
        current_memory = self.get_memory_usage()
        
        if current_memory > self.max_memory_mb:
            print(f"⚠️ זיכרון גבוה ({current_memory:.0f}MB), מנקה מודלים ישנים...")
            self.cleanup_unused_models(max_age_minutes=10)  # ניקוי יותר אגרסיבי
        
        # טעינת המודל אם עדיין לא קיים
        if model_name not in self.models:
            print(f"🔄 טוען {model_name}...")
            self.models[model_name] = loader_func()
            print(f"✅ {model_name} נטען! זיכרון: {self.get_memory_usage():.0f}MB")
        
        # עדכון זמן שימוש אחרון
        self.last_used[model_name] = datetime.now()
        
        return self.models[model_name]

# יצירת מנהל מודלים גלובלי
model_manager = ModelManager()

# פונקציות טעינה עם ניהול זיכרון
def load_sentiment_model():
    def loader():
        from transformers import pipeline
        return pipeline("sentiment-analysis")
    
    return model_manager.load_model("sentiment", loader)

async def smart_sentiment_command(update, context):
    """ניתוח רגשות עם ניהול זיכרון חכם"""
    if not context.args:
        await update.message.reply_text("שימוש: /sentiment [טקסט]")
        return
    
    text = " ".join(context.args)
    
    try:
        # ניקוי מודלים ישנים לפני טעינה חדשה
        model_manager.cleanup_unused_models()
        
        loading_msg = await update.message.reply_text("🔄 טוען מודל...")
        
        # טעינת המודל עם ניהול זיכרון
        analyzer = load_sentiment_model()
        
        await loading_msg.edit_text("🧠 מנתח...")
        
        result = analyzer(text)
        
        # הצגת תוצאות + מידע על זיכרון
        memory_usage = model_manager.get_memory_usage()
        
        result_text = f"""
📊 **ניתוח רגשות:**
📝 טקסט: "{text}"
😊 רגש: {result[0]['label']}
📈 ביטחון: {result[0]['score']:.2%}

💾 זיכרון בשימוש: {memory_usage:.0f}MB
        """
        
        await loading_msg.edit_text(result_text, parse_mode='Markdown')
        
    except Exception as e:
        await update.message.reply_text(f"❌ שגיאה: {e}")</pre>
                            </div>
                        </div>

                        <div class="success-box">
                            <h4>✅ יתרונות הטעינה העצלה:</h4>
                            <ul>
                                <li><strong>הפעלה מהירה:</strong> הבוט עולה תוך שניות במקום דקות</li>
                                <li><strong>זיכרון נמוך:</strong> צרוך רק 50-100MB במקום 500MB+</li>
                                <li><strong>יציבות:</strong> לא קורס בזמן הפעלה</li>
                                <li><strong>גמישות:</strong> טוען רק מה שבאמת צריך</li>
                            </ul>
                        </div>

                        <div class="tip-box">
                            <h4>💡 עצות נוספות לחיסכון בזיכרון:</h4>
                            <ul>
                                <li><strong>השתמש במודלים קטנים:</strong> "distilbert" במקום "bert-large"</li>
                                <li><strong>הגבל היסטוריה:</strong> שמור רק 100 הודעות אחרונות</li>
                                <li><strong>נקה cache:</strong> הרץ gc.collect() מדי פעם</li>
                                <li><strong>מודלים על פי דרישה:</strong> אם אף אחד לא משתמש בתרגום, אל תטען אותו</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- חלק ה': תחזוקה ופתרון תקלות -->
            <div class="section">
                <div class="section-header troubleshoot">
                    <h2>🔧 חלק ה': תחזוקה ופתרון תקלות</h2>
                </div>
                <div class="section-content" id="common-errors">
                    <div class="topic">
                        <h3>התקלות הנפוצות ופתרונות</h3>
                        
                        <div class="error-item">
                            <h5>🚨 telegram.error.Conflict</h5>
                            <p><strong>הסיבה:</strong> שתי גרסאות של הבוט רצות במקביל.</p>
                            <div class="solution">
                                <strong>פתרון:</strong>
                                <ol>
                                    <li>לך ל-@BotFather</li>
                                    <li>שלח: /mybots</li>
                                    <li>בחר את הבוט שלך</li>
                                    <li>לחץ "API Token"</li>
                                    <li>לחץ "Revoke current token"</li>
                                    <li>העתק את הטוקן החדש ל-Render</li>
                                </ol>
                            </div>
                        </div>

                        <div class="error-item">
                            <h5>🚨 Application exited early</h5>
                            <p><strong>הסיבה:</strong> משתנה סביבה חסר או שגוי.</p>
                            <div class="solution">
                                <strong>פתרון:</strong>
                                <ol>
                                    <li>בדוק ב-Render ← Environment שכל המשתנים קיימים</li>
                                    <li>ודא שהטוקן נכון (ללא רווחים נוספים)</li>
                                    <li>בדוק שקובץ .env נשמר כ-Secret File</li>
                                </ol>
                            </div>
                        </div>

                        <div class="error-item">
                            <h5>🚨 ModuleNotFoundError (הכי מתסכלת!)</h5>
                            <div class="solution">
                                <strong>סיבה 1: הקובץ לא ב-GitHub</strong>
                                <div class="code-block">
                                    <pre>git add .
git commit -m "Added missing files"
git push origin main
# בדוק ב-GitHub שהקבצים באמת שם!</pre>
                                </div>
                                
                                <strong>סיבה 2: חסר __init__.py</strong>
                                <div class="code-block">
                                    <pre>my_bot/
├── main.py
├── database/
│   ├── __init__.py  ← קובץ ריק חובה!
│   └── models.py</pre>
                                </div>
                                
                                <strong>סיבה 3: נתיב ייבוא שגוי</strong>
                                <div class="code-block">
                                    <pre># אם הקובץ ב-database/models.py
from database.models import User  # נכון
from models import User          # שגוי</pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="topic" id="best-practices">
                        <h3>עקרונות עבודה נכונים - איך לעבוד חכם</h3>
                        
                        <div class="success-box">
                            <h4>🔄 "Clear build cache & deploy" - הכפתור הקסום</h4>
                            <p><strong>מתי להשתמש:</strong> כשמשהו לא עובד ואתה בטוח שהקוד נכון, אבל Render עדיין מתנהג מוזר.</p>
                            
                            <strong>איך לעשות את זה:</strong>
                            <ol>
                                <li>לך לדף השירות ב-Render Dashboard</li>
                                <li>לחץ על כפתור <strong>"Manual Deploy"</strong> (למעלה מימין)</li>
                                <li>בחר באפשרות <strong>"Clear build cache & deploy"</strong></li>
                                <li>המתן 5-10 דקות לבנייה מחדש מאפס</li>
                            </ol>
                            
                            <p><strong>מה זה עושה:</strong> מוחק את כל הקבצים הזמניים, התקנות הספריות והcache, ובונה הכל מחדש מ-GitHub.</p>
                            
                            <strong>מתי זה עוזר:</strong>
                            <ul>
                                <li>ספריות לא מתעדכנות למרות שינוי requirements.txt</li>
                                <li>קבצים ישנים עדיין "תקועים" במערכת</li>
                                <li>שגיאות מוזרות שלא קשורות לקוד</li>
                                <li>אחרי שינוי גדול במבנה הפרויקט</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <h4>📱 GitHub = מקור האמת הגדול</h4>
                            <p><strong>העיקרון החשוב ביותר:</strong> מה שקובע הוא רק מה שנמצא ב-GitHub, לא מה שיש לך במחשב!</p>
                            
                            <strong>זרימת עבודה נכונה - צעד אחר צעד:</strong>
                            <div class="code-block">
                                <pre># 1. עשה שינויים בקוד במחשב שלך
# עריכת main.py, הוספת תכונות חדשות וכו'

# 2. בדוק שהכל עובד מקומי
python main.py

# 3. הוסף את כל השינויים ל-Git
git add .

# 4. בדוק מה מוכן ל-commit
git status

# 5. עשה commit עם הודעה תיאורית
git commit -m "הוספתי פקודת /weather עם API"

# 6. העלה ל-GitHub
git push origin main

# 7. בדוק ב-GitHub.com שהשינויים באמת שם!
# פתח את המאגר בדפדפן ותראה שהקבצים עודכנו

# 8. Render יבנה אוטומטית תוך כמה דקות</pre>
                            </div>
                            
                            <div class="warning-box">
                                <h5>⚠️ לא עובד? בדוק את זה:</h5>
                                <ul>
                                    <li><strong>הקובץ באמת ב-GitHub?</strong> רענן את הדף ובדוק</li>
                                    <li><strong>אין שגיאות Git?</strong> git status יראה לך הכל</li>
                                    <li><strong>Render התחבר למאגר הנכון?</strong> בדוק בהגדרות</li>
                                    <li><strong>יש הרשאות?</strong> Render צריך גישה למאגר</li>
                                </ul>
                            </div>
                        </div>

                        <div class="tip-box">
                            <h4>🧪 תשתית קודם, לוגיקה אחר כך - איך לחסוך שעות של חיפוש תקלות</h4>
                            
                            <p><strong>העיקרון:</strong> כשמשהו לא עובד, תמיד תחזור לגרסה פשוטה שעובדת, ואז תוסיף בחזרה תכונה אחת בכל פעם.</p>
                            
                            <strong>המתודולוגיה המנצחת:</strong>
                            <ol>
                                <li><strong>זרוק הכל!</strong> העתק את הקוד המורכב למקום אחר</li>
                                <li><strong>צור בוט מינימלי:</strong>
                                    <div class="code-block">
                                        <pre># main.py פשוט לדוגמה
import os
from telegram.ext import Application, CommandHandler

async def start(update, context):
    await update.message.reply_text("הלו עולם!")

def main():
    app = Application.builder().token(os.getenv('BOT_TOKEN')).build()
    app.add_handler(CommandHandler("start", start))
    app.run_polling()

if __name__ == '__main__':
    main()</pre>
                                    </div>
                                </li>
                                <li><strong>ודא שזה עובד ב-Render</strong> - הבוט עונה ל-/start?</li>
                                <li><strong>הוסף תכונה אחת חזרה</strong> - רק אחת!</li>
                                <li><strong>בדוק שעדיין עובד</strong></li>
                                <li><strong>חזור על השלבים</strong> עד שהכל חזר</li>
                            </ol>
                            
                            <p><strong>למה זה עובד?</strong> כך אתה יודע בדיוק איזה תכונה גרמה לבעיה, במקום לנחש.</p>
                            
                            <strong>דוגמה מעשית:</strong>
                            <p>הבוט שלך עובד עם MongoDB ופתאום מפסיק לענות. במקום לבדוק אלף דברים:</p>
                            <ol>
                                <li>שמור הצידה את כל הקוד של MongoDB</li>
                                <li>תן לבוט לענות רק ל-/start בלי מסד נתונים</li>
                                <li>ודא שזה עובד</li>
                                <li>הוסף בחזרה רק את החיבור ל-MongoDB</li>
                                <li>בדוק אם עדיין עובד</li>
                                <li>הוסף בחזרה פונקציה אחת של שמירת משתמשים</li>
                                <li>וכן הלאה...</li>
                            </ol>
                        </div>

                        <div class="success-box">
                            <h4>📊 מעקב ודיבאג נכון</h4>
                            
                            <strong>השתמש בלוגים חכם:</strong>
                            <div class="code-block">
                                <pre>import logging

# הגדרת logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

async def start_command(update, context):
    user_id = update.effective_user.id
    user_name = update.effective_user.first_name
    
    # רישום פעילות
    logger.info(f"User {user_id} ({user_name}) used /start command")
    
    try:
        # הקוד שלך כאן
        await update.message.reply_text("ברוך הבא!")
        logger.info(f"Successfully sent welcome message to user {user_id}")
        
    except Exception as e:
        logger.error(f"Error in start command for user {user_id}: {e}")
        await update.message.reply_text("מצטער, קרתה שגיאה. נסה שוב מאוחר יותר.")</pre>
                            </div>
                            
                            <strong>כלים לדיבאג מהיר:</strong>
                            <ul>
                                <li><strong>Render Logs:</strong> לחץ על הטאב "Logs" ושעת מה קורה בזמן אמת</li>
                                <li><strong>Print statements:</strong> לא בושה להוסיף print() זמני לדיבאג</li>
                                <li><strong>Try-Except גדול:</strong> תעטוף קוד בעייתי ב-try-except לראות השגיאה המדויקת</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <h4>🚨 טעויות נפוצות שגורמות לכאב ראש</h4>
                            <ul>
                                <li><strong>שכחת להעלות קובץ ל-Git</strong> - תמיד git status לפני push</li>
                                <li><strong>עבדת על branch שגוי</strong> - ודא שאתה על main/master</li>
                                <li><strong>לא עדכנת requirements.txt</strong> - הוספת ספרייה חדשה? הוסף לrequirements!</li>
                                <li><strong>סיסמאות בקוד</strong> - תמיד במשתני סביבה בלבד</li>
                                <li><strong>לא בדקת מקומי</strong> - אם זה לא עובד אצלך, גם לא יעבוד ב-Render</li>
                            </ul>
                        </div>

                        <div class="tip-box">
                            <h4>💡 עצות למתקדמים</h4>
                            <ul>
                                <li><strong>השתמש ב-branches:</strong> תכונה חדשה = branch חדש</li>
                                <li><strong>כתוב תיעוד:</strong> README.md עם הוראות התקנה והפעלה</li>
                                <li><strong>גרסאות ספריות:</strong> צמד מספרי גרסה במקום "latest"</li>
                                <li><strong>בדיקות אוטומטיות:</strong> כתוב tests פשוטים לפונקציות חשובות</li>
                                <li><strong>גיבוי קוד:</strong> שמור עותק של גרסאות עובדות</li>
                            </ul>
                        </div>
                    </div>

                    <div class="topic" id="summary">
                        <h3>סיכום והמלצות - המסע שלך בפיתוח בוטים</h3>
                        
                        <div class="success-box">
                            <h4>🎓 למתחילים שמתחילים עכשיו:</h4>
                            
                            <strong>המסלול המומלץ צעד אחר צעד:</strong>
                            <ol>
                                <li><strong>שלב 1 - הבסיס (יום 1):</strong>
                                    <ul>
                                        <li>עבור על ה"הכנות ראשוניות" - צור את כל החשבונות</li>
                                        <li>עקוב אחר המדריך המהיר של 10 דקות</li>
                                        <li>ודא שיש לך בוט עובד שעונה ל-/start</li>
                                    </ul>
                                </li>
                                <li><strong>שלב 2 - השבחה (שבוע 1):</strong>
                                    <ul>
                                        <li>הוסף 2-3 פקודות נוספות (/help, /info)</li>
                                        <li>חבר את MongoDB ושמור משתמשים</li>
                                        <li>הוסף פקודת admin בסיסית (/stats)</li>
                                    </ul>
                                </li>
                                <li><strong>שלב 3 - התכונות (שבוע 2-3):</strong>
                                    <ul>
                                        <li>חבר API חיצוני אחד (מזג אויר/חדשות)</li>
                                        <li>הוסף טיפול בתמונות או קבצים</li>
                                        <li>בנה מערכת תוכן פשוטה</li>
                                    </ul>
                                </li>
                                <li><strong>שלב 4 - ליטוש (חודש 1):</strong>
                                    <ul>
                                        <li>הוסף שידור הודעות למשתמשים</li>
                                        <li>שפר את הממשק עם כפתורים</li>
                                        <li>הוסף אבטחה וגיבויים</li>
                                    </ul>
                                </li>
                            </ol>
                            
                            <div class="tip-box" style="margin: 15px 0;">
                                <p><strong>💡 הכלל החשוב ביותר:</strong> אל תנסה לעשות הכל בבת אחת. כל שבוע הוסף תכונה אחת חדשה ותבדוק שהכל עובד.</p>
                            </div>
                        </div>

                        <div class="info-box">
                            <h4>⚡ למתקדמים שרוצים לקחת את זה לרמה הבאה:</h4>
                            
                            <strong>תכונות מתקדמות להוסיף:</strong>
                            <ul>
                                <li><strong>מערכת כלכלה:</strong> נקודות, מטבעות וירטואליים, רכישות</li>
                                <li><strong>משחקים:</strong> חידות, טריוויה, משחקי טקסט</li>
                                <li><strong>אוטומציה:</strong> הודעות מתוזמנות, תזכורות</li>
                                <li><strong>אינטגרציות:</strong> Google Sheets, Notion, Discord</li>
                                <li><strong>בינה מלאכותית:</strong> ChatGPT, יצירת תמונות, תרגומים</li>
                                <li><strong>אנליטיקות:</strong> גרפים של שימוש, דוחות מפורטים</li>
                            </ul>
                            
                            <strong>אופטימיזציות לביצועים:</strong>
                            <ul>
                                <li><strong>שתי שרתים:</strong> בוט + API נפרדים</li>
                                <li><strong>Redis cache:</strong> לנתונים שנצפים הרבה</li>
                                <li><strong>Message queues:</strong> עיבוד משימות ברקע</li>
                                <li><strong>Load balancing:</strong> מספר instances של הבוט</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <h4>🚨 להימנע מהטעויות הגדולות:</h4>
                            
                            <table style="width: 100%; margin: 10px 0;">
                                <tr>
                                    <th>הטעות</th>
                                    <th>למה זה רע</th>
                                    <th>מה לעשות במקום</th>
                                </tr>
                                <tr>
                                    <td>שמירת טוקנים בקוד</td>
                                    <td>כל מי שרואה את GitHub יכול להשתלט על הבוט</td>
                                    <td>תמיד משתני סביבה</td>
                                </tr>
                                <tr>
                                    <td>לא לבדוק מקומי לפני push</td>
                                    <td>מגלה שגיאות רק ב-Render אחרי 10 דקות</td>
                                    <td>python main.py תמיד לפני git push</td>
                                </tr>
                                <tr>
                                    <td>לא להשתמש ב-try/except</td>
                                    <td>הבוט קורס בכל שגיאה קטנה</td>
                                    <td>תעטוף כל פונקציה ב-try/except</td>
                                </tr>
                                <tr>
                                    <td>להטעין הכל בהתחלה</td>
                                    <td>הבוט לא עולה או קורס מזיכרון</td>
                                    <td>Lazy loading - טען רק כשצריך</td>
                                </tr>
                                <tr>
                                    <td>לא לעשות גיבויים</td>
                                    <td>מאבד שבועות עבודה אם משהו נשבר</td>
                                    <td>commit תכוף + MongoDB Atlas אוטו-גיבוי</td>
                                </tr>
                            </table>
                        </div>

                        <div class="success-box">
                            <h4>🎯 כללי זהב לבוט מקצועי:</h4>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                                <div>
                                    <h5>📁 ארגון וקוד:</h5>
                                    <ul>
                                        <li>קובץ נפרד לכל תכונה</li>
                                        <li>תיעוד בעברית לכל פונקציה</li>
                                        <li>שמות משתנים ברורים</li>
                                        <li>מבנה תיקיות הגיוני</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5>🔒 אבטחה ויציבות:</h5>
                                    <ul>
                                        <li>אף פעם לא מפתחות בקוד</li>
                                        <li>validation על כל קלט משתמש</li>
                                        <li>rate limiting למניעת ספאם</li>
                                        <li>לוגים מפורטים לדיבאג</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                                <div>
                                    <h5>🐛 תחזוקה ותקלות:</h5>
                                    <ul>
                                        <li>GitHub תמיד קודם, Render אחר כך</li>
                                        <li>commit תכוף עם הודעות ברורות</li>
                                        <li>בדיקה מקומית לפני העלאה</li>
                                        <li>גרסאות קבועות בrequirements.txt</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5>💾 נתונים וגיבוי:</h5>
                                    <ul>
                                        <li>MongoDB Atlas לעמידות</li>
                                        <li>גיבוי אוטומטי לנתונים חשובים</li>
                                        <li>מעקב אחר שימוש ותקלות</li>
                                        <li>ניקוי נתונים ישנים</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="tip-box">
                            <h4>📚 משאבים נוספים ללמידה:</h4>
                            
                            <strong>תיעוד רשמי:</strong>
                            <ul>
                                <li><strong>python-telegram-bot:</strong> python-telegram-bot.readthedocs.io</li>
                                <li><strong>Telegram Bot API:</strong> core.telegram.org/bots/api</li>
                                <li><strong>MongoDB Python:</strong> pymongo.readthedocs.io</li>
                                <li><strong>Render Docs:</strong> render.com/docs</li>
                            </ul>
                            
                            <strong>קהילות ועזרה:</strong>
                            <ul>
                                <li><strong>Stack Overflow:</strong> חיפוש של שגיאות ספציפיות</li>
                                <li><strong>Reddit r/Python:</strong> קהילה פעילה ועוזרת</li>
                                <li><strong>Discord/Telegram groups:</strong> קבוצות מפתחים ישראליים</li>
                                <li><strong>GitHub Issues:</strong> דיווח באגים בספריות</li>
                            </ul>
                        </div>

                        <div class="success-box">
                            <h4>🎉 ברכות - הגעת לסוף!</h4>
                            <p>אם קראת עד לכאן, יש לך עכשיו את כל הכלים ליצור בוט טלגרם מקצועי. זכור - <strong>כל מפתח מנוסה התחיל עם בוט פשוט שענה ל-/start</strong>.</p>
                            
                            <p><strong>הקסם הוא בהמשכיות:</strong> תוסיף תכונה אחת בשבוע, תלמד משגיאות, ותשפר כל הזמן. בעוד שנה תסתכל חזרה ותתפלא כמה התקדמת!</p>
                            
                            <p style="text-align: center; font-size: 1.2em; margin-top: 20px;">
                                <strong>🚀 בהצלחה בבניית הבוט שלך! 🤖</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- חלק ו': שימוש מתקדם ותחזוקה -->
            <div class="section">
                <div class="section-header advanced">
                    <h2>⚡ חלק ו': שימוש מתקדם ותחזוקה</h2>
                    <div class="level-indicator">
                        <span class="badge advanced">מתקדם</span>
                        <div class="level-dot"></div>
                        <div class="level-dot"></div>
                        <div class="level-dot advanced active"></div>
                    </div>
                </div>
                <div class="section-content">
                    
                    <!-- 1. טיפול בשגיאות מתקדם -->
                    <div class="topic" id="error-handling">
                        <h3>🛡️ טיפול בשגיאות מתקדם</h3>
                        
                        <div class="info-box">
                            <h4>🎯 למה Error Handling זה קריטי?</h4>
                            <p>בוט ללא טיפול נכון בשגיאות הוא כמו רכב ללא בלמים - יעבוד טוב עד הרגע הראשון שמשהו ישתבש, ואז הכל יקרוס.</p>
                            <ul>
                                <li><strong>יציבות:</strong> הבוט ממשיך לפעול גם כשיש תקלות</li>
                                <li><strong>חוויית משתמש:</strong> הודעות שגיאה ברורות במקום קריסה</li>
                                <li><strong>דיבוג:</strong> לוגים מפורטים לזיהוי בעיות</li>
                                <li><strong>שחזור אוטומטי:</strong> ניסיון חוזר לפעולות שנכשלו</li>
                            </ul>
                        </div>

                        <div class="subtopic">
                            <h4>מערכת Error Handler מקיפה:</h4>
                            <div class="code-block">
                                <h5>🔧 הטמעת מטפל שגיאות חכם:</h5>
                                <pre>import logging
from telegram.ext import Application, ContextTypes
from telegram.error import Conflict, NetworkError, TimedOut, BadRequest
import asyncio
from datetime import datetime

# הגדרת לוגים מפורטים
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", 
    level=logging.INFO
)
logger = logging.getLogger(__name__)

class ErrorHandler:
    def __init__(self):
        self.error_count = {}
        self.last_error_time = {}
    
    async def handle_error(self, update, context: ContextTypes.DEFAULT_TYPE):
        """מטפל מתקדם בכל סוגי השגיאות"""
        error = context.error
        error_type = type(error).__name__
        
        # ספירת שגיאות לסטטיסטיקה
        self.error_count[error_type] = self.error_count.get(error_type, 0) + 1
        self.last_error_time[error_type] = datetime.now()
        
        # טיפול ספציפי לכל סוג שגיאה
        if isinstance(error, Conflict):
            await self._handle_conflict_error(update, context)
        elif isinstance(error, NetworkError):
            await self._handle_network_error(update, context)
        elif isinstance(error, TimedOut):
            await self._handle_timeout_error(update, context)
        elif isinstance(error, BadRequest):
            await self._handle_bad_request_error(update, context)
        else:
            await self._handle_unknown_error(update, context)
    
    async def _handle_conflict_error(self, update, context):
        """טיפול בשגיאת Conflict (409)"""
        logger.warning("⚠️ Conflict Error - ייתכן ויש מופע נוסף של הבוט")
        logger.warning("💡 פתרון: בדוק שאין שני בוטים רצים במקביל")
        
        # לא נשלח הודעה למשתמש - זו בעיה טכנית
        # רק נרשום ללוג ונמשיך
        
    async def _handle_network_error(self, update, context):
        """טיפול בבעיות רשת"""
        logger.error(f"🌐 Network Error: {context.error}")
        
        if update and update.effective_chat:
            try:
                await context.bot.send_message(
                    chat_id=update.effective_chat.id,
                    text="⚠️ בעיית רשת זמנית. אנא נסה שוב בעוד כמה שניות."
                )
            except Exception as e:
                logger.error(f"Failed to send network error message: {e}")
    
    async def _handle_timeout_error(self, update, context):
        """טיפול בפסק זמן"""
        logger.warning(f"⏰ Timeout Error: {context.error}")
        
        if update and update.effective_chat:
            try:
                await context.bot.send_message(
                    chat_id=update.effective_chat.id,
                    text="⏰ הפעולה לקחה יותר מדי זמן. אנא נסה שוב."
                )
            except Exception as e:
                logger.error(f"Failed to send timeout error message: {e}")
    
    async def _handle_bad_request_error(self, update, context):
        """טיפול בבקשות שגויות"""
        error_msg = str(context.error)
        logger.error(f"❌ Bad Request: {error_msg}")
        
        # הודעות שגיאה ידידותיות למשתמש
        user_message = "מצטער, לא הצלחתי לעבד את הבקשה."
        
        if "message is not modified" in error_msg.lower():
            # שגיאה נפוצה - לא צריך להודיע למשתמש
            logger.info("Message not modified - ignoring")
            return
        elif "chat not found" in error_msg.lower():
            user_message = "השיחה לא נמצאה. אנא התחל שיחה חדשה עם /start"
        elif "message can't be edited" in error_msg.lower():
            user_message = "לא ניתן לערוך הודעה זו."
        
        if update and update.effective_chat:
            try:
                await context.bot.send_message(
                    chat_id=update.effective_chat.id,
                    text=f"❌ {user_message}"
                )
            except Exception as e:
                logger.error(f"Failed to send bad request error message: {e}")
    
    async def _handle_unknown_error(self, update, context):
        """טיפול בשגיאות לא מוכרות"""
        logger.error(f"🚨 Unknown Error: {type(context.error).__name__}: {context.error}")
        
        if update and update.effective_chat:
            try:
                await context.bot.send_message(
                    chat_id=update.effective_chat.id,
                    text="🔧 אירעה שגיאה טכנית. הצוות הטכני קיבל דיווח ויטפל בבעיה."
                )
            except Exception as e:
                logger.error(f"Failed to send unknown error message: {e}")
    
    def get_error_stats(self):
        """החזרת סטטיסטיקות שגיאות"""
        return {
            "error_counts": self.error_count.copy(),
            "last_errors": {k: v.isoformat() for k, v in self.last_error_time.items()}
        }

# יצירת מטפל שגיאות גלובלי
error_handler = ErrorHandler()

# הוספה לאפליקציה
application = Application.builder().token(os.getenv('BOT_TOKEN')).build()
application.add_error_handler(error_handler.handle_error)</pre>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ שגיאות שצריך להתעלם מהן</h4>
                            <p>לא כל שגיאה צריכה לגרום לפאניקה. השגיאות הבאות הן נורמליות ולא מצריכות התערבות:</p>
                            <ul>
                                <li><strong>"Message is not modified"</strong> - המשתמש לחץ על אותו כפתור פעמיים</li>
                                <li><strong>"Query is too old"</strong> - המשתמש לחץ על כפתור ישן</li>
                                <li><strong>"Chat not found"</strong> - המשתמש חסם את הבוט</li>
                                <li><strong>"Bot was blocked by the user"</strong> - המשתמש חסם את הבוט</li>
                            </ul>
                        </div>

                        <div class="tip-box">
                            <h4>💡 טיפים לError Handling מקצועי:</h4>
                            <ul>
                                <li><strong>לוגים מדורגים:</strong> INFO לפעולות רגילות, WARNING לבעיות קלות, ERROR לבעיות חמורות</li>
                                <li><strong>Retry Logic:</strong> נסה שוב פעולות שנכשלו בגלל בעיות רשת</li>
                                <li><strong>Circuit Breaker:</strong> הפסק לנסות אם יש יותר מדי שגיאות</li>
                                <li><strong>Graceful Degradation:</strong> הצע תכונות מוגבלות אם המערכת המלאה לא עובדת</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 2. פתרון קונפליקטי Polling -->
                    <div class="topic" id="polling-conflicts">
                        <h3>🔄 פתרון קונפליקטי Polling</h3>
                        
                        <div class="warning-box">
                            <h4>🚨 הבעיה: "409 Conflict - terminated by other getUpdates request"</h4>
                            <p>השגיאה הזו מופיעה כאשר יש שני מופעים או יותר של הבוט שמנסים לקבל עדכונים מטלגרם במקביל. טלגרם מאפשר רק חיבור אחד בכל רגע נתון.</p>
                            
                            <strong>מתי זה קורה?</strong>
                            <ul>
                                <li>הפעלת הבוט במחשב המקומי וגם ב-Render</li>
                                <li>שני שירותים ב-Render עם אותו טוקן</li>
                                <li>Scheduled Jobs ב-Render שמפעילים את הבוט</li>
                                <li>שכחת לעצור גרסה ישנה של הבוט</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <h4>💡 הפתרון: הפרדה עם משתנה RUN_MODE</h4>
                            <p>נשתמש במשתנה סביבתי שיגדיר מה הבוט צריך לעשות - לרוץ כבוט רגיל או להריץ רק משימות רקע.</p>
                        </div>

                        <div class="subtopic">
                            <h4>יישום הפתרון המלא:</h4>
                            <div class="code-block">
                                <h5>📄 קובץ main.py עם הפרדת מצבי הרצה:</h5>
                                <pre>import os
import logging
from telegram.ext import Application, CommandHandler, MessageHandler, filters
from threading import Thread
from flask import Flask
import asyncio
from datetime import datetime

# הגדרת לוגים
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", 
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# ===== שרת Keep-Alive =====
app = Flask(__name__)

@app.route('/')
def health_check():
    run_mode = os.getenv('RUN_MODE', 'bot')
    return f"🤖 Bot Status: {run_mode} mode active", 200

def run_flask():
    """מריץ את שרת ה-Flask ב-thread נפרד"""
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port, debug=False)

# ===== פונקציות הבוט =====
async def start(update, context):
    """פקודת /start"""
    user_name = update.effective_user.first_name
    await update.message.reply_text(f"שלום {user_name}! 👋\nהבוט פועל במצב רגיל.")

async def echo(update, context):
    """מחזיר הודעות"""
    text = update.message.text
    await update.message.reply_text(f"קיבלתי: {text}")

# ===== משימות רקע =====
async def scheduled_task():
    """משימה שרצה מדי יום"""
    logger.info("🕐 מריץ משימה יומית...")
    
    # כאן תוכל להוסיף:
    # - ניקוי מסד נתונים
    # - שליחת דוחות
    # - גיבוי נתונים
    # - בדיקת תקינות מערכות
    
    logger.info("✅ משימה יומית הושלמה")

async def run_scheduler():
    """מריץ משימות מתוזמנות"""
    logger.info("📅 מתחיל scheduler במצב cron")
    
    while True:
        try:
            current_hour = datetime.now().hour
            
            # משימה יומית ב-3:00 בלילה
            if current_hour == 3:
                await scheduled_task()
                # חכה שעה כדי לא להריץ שוב
                await asyncio.sleep(3600)
            else:
                # בדוק כל 10 דקות
                await asyncio.sleep(600)
                
        except Exception as e:
            logger.error(f"❌ שגיאה ב-scheduler: {e}")
            await asyncio.sleep(300)  # חכה 5 דקות ונסה שוב

# ===== פונקציה ראשית =====
def main():
    """הפונקציה הראשית עם הפרדת מצבים"""
    
    # קריאת מצב ההרצה
    run_mode = os.getenv('RUN_MODE', 'bot')
    logger.info(f"🚀 מתחיל במצב: {run_mode}")
    
    # הפעלת שרת Keep-Alive בכל מצב
    logger.info("🌐 מפעיל שרת Keep-Alive...")
    flask_thread = Thread(target=run_flask, daemon=True)
    flask_thread.start()
    
    if run_mode == 'cron':
        # מצב Cron - רק משימות רקע
        logger.info("📅 מפעיל במצב Cron - משימות רקע בלבד")
        asyncio.run(run_scheduler())
        
    else:
        # מצב Bot - הפעלה רגילה
        logger.info("🤖 מפעיל במצב Bot - Polling רגיל")
        
        # בדיקת טוקן
        bot_token = os.getenv('BOT_TOKEN')
        if not bot_token:
            logger.error("❌ BOT_TOKEN לא נמצא!")
            return
        
        # בניית הבוט
        application = Application.builder().token(bot_token).build()
        
        # הוספת handlers
        application.add_handler(CommandHandler("start", start))
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo))
        
        # הפעלת הבוט
        logger.info("✅ הבוט מתחיל Polling...")
        application.run_polling(drop_pending_updates=True)

if __name__ == '__main__':
    main()</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>הגדרה ב-Render:</h4>
                            <div class="success-box">
                                <h5>🔧 הגדרת שני שירותים נפרדים:</h5>
                                
                                <strong>שירות 1 - הבוט הראשי:</strong>
                                <ul>
                                    <li><strong>Type:</strong> Web Service</li>
                                    <li><strong>Name:</strong> my-telegram-bot</li>
                                    <li><strong>Environment Variables:</strong> 
                                        <div class="code-block">
                                            <pre>RUN_MODE=bot
BOT_TOKEN=your_bot_token_here</pre>
                                        </div>
                                    </li>
                                </ul>
                                
                                <strong>שירות 2 - משימות רקע (אופציונלי):</strong>
                                <ul>
                                    <li><strong>Type:</strong> Background Worker</li>
                                    <li><strong>Name:</strong> my-telegram-bot-cron</li>
                                    <li><strong>Environment Variables:</strong>
                                        <div class="code-block">
                                            <pre>RUN_MODE=cron
BOT_TOKEN=your_bot_token_here</pre>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="tip-box">
                            <h4>🛡️ טיפ זהב למניעת קונפליקטים:</h4>
                            <p><strong>שירותי Render ותכונת Scheduled Jobs:</strong></p>
                            <p>אם אתה משתמש ב-Scheduled Jobs של Render, וודא שהם מפעילים את הקוד עם <code>RUN_MODE=cron</code>, כך:</p>
                            <div class="code-block">
                                <pre># ב-Scheduled Job של Render
RUN_MODE=cron python main.py</pre>
                            </div>
                            <p>זה יבטיח שהמשימה המתוזמנת לא תנסה להפעיל polling נוסף.</p>
                        </div>
                    </div>

                    <!-- 3. מודלי Anthropic API -->
                    <div class="topic" id="anthropic-models">
                        <h3>🧠 מודלי Anthropic API</h3>
                        
                        <div class="info-box">
                            <h4>🎯 למה Anthropic Claude?</h4>
                            <p>Claude של Anthropic הוא חלופה מעולה ל-ChatGPT עם יתרונות ייחודיים:</p>
                            <ul>
                                <li><strong>חלון הקשר גדול:</strong> עד 200,000 טוקנים (לעומת 4,000-32,000 ב-GPT)</li>
                                <li><strong>בטיחות גבוהה:</strong> פחות סיכוי לתוכן מזיק או לא מתאים</li>
                                <li><strong>דיוק טוב:</strong> במיוחד בקריאה וניתוח של טקסטים ארוכים</li>
                                <li><strong>תמחור תחרותי:</strong> מחירים דומים או טובים יותר מ-OpenAI</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ הבעיה הנפוצה: שמות מודלים לא מדויקים</h4>
                            <p>בניגוד ל-OpenAI שיש לו שמות פשוטים כמו "gpt-3.5-turbo", ל-Anthropic יש שמות מודלים מדויקים עם תאריכים. <strong>חובה</strong> להשתמש בשמות המדויקים!</p>
                        </div>

                        <div class="subtopic">
                            <h4>איך למצוא שמות מודלים מדויקים:</h4>
                            <div class="success-box">
                                <h5>🔍 שלבים לקבלת שמות מודלים נכונים:</h5>
                                <ol>
                                    <li><strong>היכנס לקונסולה:</strong> <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a></li>
                                    <li><strong>עבור ל-Limits:</strong> <a href="https://console.anthropic.com/settings/limits" target="_blank">console.anthropic.com/settings/limits</a></li>
                                    <li><strong>בטבלה תראה את כל המודלים הזמינים:</strong>
                                        <ul>
                                            <li>העמודה "MODEL" מכילה את השמות המדויקים</li>
                                            <li>כל מודל כולל תאריך (למשל: claude-3-opus-20240229)</li>
                                            <li>זהו בדיוק השם שצריך להשתמש בו ב-API</li>
                                        </ul>
                                    </li>
                                </ol>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שמות מודלים נכונים (נכון ליולי 2025):</h4>
                            <div class="code-block">
                                <h5>📋 רשימת מודלים זמינים:</h5>
                                <pre># Claude 4 Opus (הדגם החכם והמתקדם ביותר)
claude-opus-4-20250514

# Claude 4 Sonnet (ביצועים גבוהים עם איזון מעולה)
claude-sonnet-4-20250514

# Claude 3.7 Sonnet (עם יכולת חשיבה מורחבת)
claude-3-7-sonnet-20250219

# Claude 3.5 Sonnet (גרסה מעודכנת)
claude-3-5-sonnet-20241022

# Claude 3.5 Haiku (המהיר והחסכוני ביותר)
claude-3-5-haiku-20241022</pre>
                            </div>
                            
                            <div class="warning-box">
                                <h5>⚠️ חשוב לזכור:</h5>
                                <ul>
                                    <li><strong>התאריכים חשובים:</strong> הם חלק מהשם הרשמי של המודל</li>
                                    <li><strong>רגישות לאותיות:</strong> השם חייב להיות מדויק בדיוק</li>
                                    <li><strong>מודלים עדכניים:</strong> Claude 4 מגיע עם יכולות מתקדמות בקידוד ובחשיבה מורכבת</li>
                                    <li><strong>זמינות:</strong> לא כל המודלים זמינים לכל המשתמשים - תלוי ברמת הגישה</li>
                                    <li><strong>מודלים שהוסרו:</strong> Claude 3 Opus, Claude 3 Sonnet ו-Claude 3 Haiku הישנים הוסרו מהשימוש</li>
                                </ul>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>דוגמה מעשית לשימוש:</h4>
                            <div class="code-block">
                                <h5>🐍 קוד Python עם Anthropic API:</h5>
                                <pre>import anthropic
import os

# הגדרת המפתח
client = anthropic.Anthropic(
    api_key=os.getenv('ANTHROPIC_API_KEY')
)

async def ask_claude(question, model_type="sonnet"):
    """שאילתה ל-Claude עם בחירת מודל"""
    
    # מיפוי שמות נוחים לשמות מדויקים
    model_names = {
        "opus": "claude-3-opus-20240229",      # הכי חכם וחזק
        "sonnet": "claude-3-sonnet-20240229",  # איזון טוב
        "haiku": "claude-3-haiku-20240307"     # מהיר וזול
    }
    
    model_name = model_names.get(model_type, model_names["sonnet"])
    
    try:
        response = client.messages.create(
            model=model_name,
            max_tokens=1000,
            temperature=0.7,
            messages=[
                {
                    "role": "user",
                    "content": f"ענה בעברית בצורה ברורה וקצרה: {question}"
                }
            ]
        )
        
        return response.content[0].text
        
    except Exception as e:
        return f"שגיאה בפנייה ל-Claude: {e}"

# דוגמת שימוש בבוט
async def claude_command(update, context):
    """פקודת /claude עם שאלה"""
    if not context.args:
        await update.message.reply_text(
            "שימוש: /claude [השאלה שלך]\n"
            "דוגמה: /claude מה זה בינה מלאכותית?"
        )
        return
    
    question = " ".join(context.args)
    
    # הודעת המתנה
    loading_msg = await update.message.reply_text("🧠 Claude חושב...")
    
    try:
        # קריאה ל-Claude (ברירת מחדל: sonnet)
        answer = await ask_claude(question, "sonnet")
        
        # עדכון ההודעה עם התשובה
        await loading_msg.edit_text(f"🤖 **Claude מענה:**\n\n{answer}", parse_mode='Markdown')
        
    except Exception as e:
        await loading_msg.edit_text(f"❌ שגיאה: {e}")

# הוספה לבוט
application.add_handler(CommandHandler("claude", claude_command))</pre>
                            </div>
                        </div>

                        <div class="tip-box">
                            <h4>💡 טיפים לעבודה עם Claude:</h4>
                            <ul>
                                <li><strong>בחירת מודל נכונה:</strong> Haiku למשימות פשוטות, Sonnet לרוב המשימות, Opus לעבודות מורכבות</li>
                                <li><strong>ניהול עלויות:</strong> Claude יכול להיות יקר - הגבל את max_tokens</li>
                                <li><strong>חלון הקשר:</strong> נצל את היכולת לשלוח טקסטים ארוכים</li>
                                <li><strong>תיעוד מעודכן:</strong> <a href="https://docs.anthropic.com/claude/docs/models-overview" target="_blank">docs.anthropic.com/claude/docs/models-overview</a></li>
                            </ul>
                        </div>
                    </div>

                    <!-- 4. עריכת הודעות ללא שגיאות -->
                    <div class="topic" id="message-editing">
                        <h3>✏️ עריכת הודעות ללא שגיאות</h3>
                        
                        <div class="warning-box">
                            <h4>🚨 הבעיה הנפוצה: "Message is not modified"</h4>
                            <p>כאשר משתמש לוחץ פעמיים על אותו כפתור, או כשמנסים לערוך הודעה לאותו תוכן בדיוק, טלגרם מחזיר שגיאה: <code>telegram.error.BadRequest: Message is not modified</code></p>
                            
                            <strong>מתי זה קורה?</strong>
                            <ul>
                                <li>לחיצה כפולה מהירה על כפתור</li>
                                <li>עריכת הודעה לאותו תוכן בדיוק</li>
                                <li>שינוי סדר כפתורים בלי שינוי תוכן</li>
                                <li>רענון מסך במהלך עריכה</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <h4>💡 הפתרון: Try-Except חכם + אנימצית טעינה</h4>
                            <p>נשלב שני טכניקות:</p>
                            <ol>
                                <li><strong>אנימציית טעינה מדומה</strong> - נותנת תחושת תגובתיות</li>
                                <li><strong>Try-Except מתוחכם</strong> - מתעלם משגיאות לא חשובות</li>
                            </ol>
                        </div>

                        <div class="subtopic">
                            <h4>הטמעת הפתרון המלא:</h4>
                            <div class="code-block">
                                <h5>🔧 פונקציה לעריכה בטוחה:</h5>
                                <pre>import asyncio
from telegram.error import BadRequest
import logging

logger = logging.getLogger(__name__)

async def safe_edit_message(query, new_text=None, new_markup=None, show_loading=True):
    """עריכת הודעה בטוחה עם טיפול בשגיאות"""
    
    try:
        # שלב 1: אנימציית טעינה (אופציונלי)
        if show_loading:
            await query.edit_message_text("⏳ טוען...", reply_markup=None)
            await asyncio.sleep(0.1)  # השהייה קצרה לתחושת תגובתיות
        
        # שלב 2: עריכה אמיתית
        if new_text and new_markup:
            await query.edit_message_text(text=new_text, reply_markup=new_markup)
        elif new_text:
            await query.edit_message_text(text=new_text)
        elif new_markup:
            await query.edit_message_reply_markup(reply_markup=new_markup)
        
        return True
        
    except BadRequest as e:
        error_msg = str(e).lower()
        
        # שגיאות שאפשר להתעלם מהן
        if any(ignore_phrase in error_msg for ignore_phrase in [
            "message is not modified",
            "query is too old",
            "message can't be edited"
        ]):
            logger.info(f"Ignored harmless error: {e}")
            return False
        
        # שגיאות חמורות יותר
        else:
            logger.error(f"Serious edit error: {e}")
            try:
                await query.answer("❌ לא הצלחתי לעדכן את ההודעה", show_alert=True)
            except:
                pass  # גם זה יכול להיכשל, לא נורא
            return False
    
    except Exception as e:
        logger.error(f"Unexpected error in safe_edit_message: {e}")
        return False

async def safe_answer_callback(query, text="", show_alert=False):
    """מענה בטוח לCallback Query"""
    try:
        await query.answer(text=text, show_alert=show_alert)
    except BadRequest as e:
        if "query is too old" in str(e).lower():
            logger.info("Callback query too old - ignoring")
        else:
            logger.error(f"Callback answer error: {e}")
    except Exception as e:
        logger.error(f"Unexpected callback error: {e}")</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>דוגמאות שימוש מעשיות:</h4>
                            <div class="code-block">
                                <h5>🎮 דוגמה 1: תפריט עם כפתורים:</h5>
                                <pre>from telegram import InlineKeyboardButton, InlineKeyboardMarkup

async def show_menu(update, context):
    """הצגת תפריט עם כפתורים"""
    keyboard = [
        [InlineKeyboardButton("📊 סטטיסטיקות", callback_data="stats")],
        [InlineKeyboardButton("⚙️ הגדרות", callback_data="settings")],
        [InlineKeyboardButton("❓ עזרה", callback_data="help")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    menu_text = """
🏠 **תפריט ראשי**

בחר אחת מהאפשרויות:
    """
    
    if update.callback_query:
        # עדכון הודעה קיימת
        await safe_edit_message(
            update.callback_query, 
            new_text=menu_text, 
            new_markup=reply_markup
        )
        await safe_answer_callback(update.callback_query)
    else:
        # הודעה חדשה
        await update.message.reply_text(menu_text, reply_markup=reply_markup, parse_mode='Markdown')

async def handle_menu_callback(update, context):
    """טיפול בלחיצות על כפתורי התפריט"""
    query = update.callback_query
    data = query.data
    
    if data == "stats":
        stats_text = """
📊 **סטטיסטיקות הבוט**

👥 משתמשים: 150
💬 הודעות היום: 45
⚡ זמן פעילות: 99.9%

[חזרה לתפריט] /menu
        """
        await safe_edit_message(query, new_text=stats_text)
        await safe_answer_callback(query, "📊 טוען סטטיסטיקות...")
        
    elif data == "settings":
        settings_keyboard = [
            [InlineKeyboardButton("🔔 התראות", callback_data="toggle_notifications")],
            [InlineKeyboardButton("🌐 שפה", callback_data="change_language")],
            [InlineKeyboardButton("🔙 חזרה", callback_data="back_to_menu")]
        ]
        settings_markup = InlineKeyboardMarkup(settings_keyboard)
        
        settings_text = """
⚙️ **הגדרות**

התאם את הבוט לצרכים שלך:
        """
        
        await safe_edit_message(query, new_text=settings_text, new_markup=settings_markup)
        await safe_answer_callback(query, "⚙️ פותח הגדרות...")
        
    elif data == "help":
        help_text = """
❓ **עזרה ותמיכה**

📖 פקודות זמינות:
/start - התחלת שיחה
/menu - תפריט ראשי  
/help - עזרה

💬 לתמיכה: @support_bot
        """
        await safe_edit_message(query, new_text=help_text)
        await safe_answer_callback(query, "❓ טוען עזרה...")
        
    elif data == "back_to_menu":
        await show_menu(update, context)

# הוספה לבוט
application.add_handler(CommandHandler("menu", show_menu))
application.add_handler(CallbackQueryHandler(handle_menu_callback))</pre>
                            </div>
                        </div>

                        <div class="success-box">
                            <h4>✅ יתרונות הגישה הזו:</h4>
                            <ul>
                                <li><strong>חוויית משתמש טובה:</strong> אנימציית טעינה נותנת תחושת תגובתיות</li>
                                <li><strong>יציבות:</strong> הבוט לא קורס מלחיצות כפולות</li>
                                <li><strong>לוגים נקיים:</strong> שגיאות לא חשובות לא מבלבלות</li>
                                <li><strong>מקצועיות:</strong> הבוט נראה מלוטש ואמין</li>
                            </ul>
                        </div>

                        <div class="tip-box">
                            <h4>💡 טיפים נוספים לעריכת הודעות:</h4>
                            <ul>
                                <li><strong>השתמש ב-parse_mode:</strong> 'Markdown' או 'HTML' לעיצוב טקסט</li>
                                <li><strong>הגבל אורך הודעות:</strong> טלגרם מגביל ל-4096 תווים</li>
                                <li><strong>שמור מצב:</strong> זכור איזה הודעה המשתמש רואה</li>
                                <li><strong>בדוק הרשאות:</strong> ודא שהבוט יכול לערוך הודעות בקבוצה</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 5. Google Custom Search API -->
                    <div class="topic" id="google-search-api">
                        <h3>🔍 Google Custom Search API</h3>
                        
                        <div class="info-box">
                            <h4>🌐 למה Google Custom Search?</h4>
                            <p>Google Custom Search API מאפשר לבוט שלך לבצע חיפושים בגוגל ולהחזיר תוצאות מובנות. זה שימושי עבור:</p>
                            <ul>
                                <li><strong>בוטי מידע:</strong> חיפוש מהיר של מידע עדכני</li>
                                <li><strong>בוטי חדשות:</strong> מציאת מאמרים רלוונטיים</li>
                                <li><strong>בוטי מחקר:</strong> איסוף מקורות ממגוון אתרים</li>
                                <li><strong>בוטי שירות:</strong> מציאת עסקים ושירותים מקומיים</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <h4>⚠️ דרישה חשובה: שני מפתחות נדרשים!</h4>
                            <p>בניגוד ל-APIs אחרים, Google Custom Search דורש <strong>שני</strong> מפתחות:</p>
                            <ol>
                                <li><strong>GOOGLE_API_KEY</strong> - מפתח API מ-Google Cloud Console</li>
                                <li><strong>GOOGLE_SEARCH_ENGINE_ID</strong> (או GOOGLE_CX) - מזהה מנוע חיפוש מותאם</li>
                            </ol>
                            <p><strong>בלי שניהם - ה-API לא יעבוד!</strong></p>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 1: קבלת Google API Key:</h4>
                            <div class="success-box">
                                <h5>🔑 יצירת מפתח API:</h5>
                                <ol>
                                    <li><strong>לך ל-Google Cloud Console:</strong> <a href="https://console.cloud.google.com/" target="_blank">console.cloud.google.com</a></li>
                                    <li><strong>צור פרויקט חדש</strong> או בחר פרויקט קיים</li>
                                    <li><strong>הפעל את Custom Search API:</strong>
                                        <ul>
                                            <li>לך ל-"APIs & Services" ← "Library"</li>
                                            <li>חפש "Custom Search API"</li>
                                            <li>לחץ "Enable"</li>
                                        </ul>
                                    </li>
                                    <li><strong>צור מפתח API:</strong>
                                        <ul>
                                            <li>לך ל-"APIs & Services" ← "Credentials"</li>
                                            <li>לחץ "Create Credentials" ← "API Key"</li>
                                            <li>העתק את המפתח (מתחיל ב-AIzaSy...)</li>
                                        </ul>
                                    </li>
                                </ol>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 2: יצירת Custom Search Engine:</h4>
                            <div class="success-box">
                                <h5>🛠️ הגדרת מנוע חיפוש מותאם:</h5>
                                <ol>
                                    <li><strong>לך ל-Custom Search Engine:</strong> <a href="https://cse.google.com/" target="_blank">cse.google.com</a></li>
                                    <li><strong>לחץ "Add"</strong> ליצירת מנוע חדש</li>
                                    <li><strong>הגדר את המנוע:</strong>
                                        <ul>
                                            <li><strong>Sites to search:</strong> כתוב "*" לחיפוש בכל האינטרנט</li>
                                            <li><strong>Language:</strong> Hebrew או English</li>
                                            <li><strong>Name:</strong> שם תיאורי למנוע</li>
                                        </ul>
                                    </li>
                                    <li><strong>לחץ "Create"</strong></li>
                                    <li><strong>קבל את המזהה:</strong>
                                        <ul>
                                            <li>לחץ על המנוע שיצרת</li>
                                            <li>לך ל-"Setup" ← "Basics"</li>
                                            <li>העתק את ה-"Search engine ID" (נראה כמו: 0df4f2xxxxxxxx:abcd12345)</li>
                                        </ul>
                                    </li>
                                </ol>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>שלב 3: יישום ב-Python:</h4>
                            <div class="code-block">
                                <h5>🐍 קוד מלא לחיפוש Google:</h5>
                                <pre>import requests
import os
import logging
from urllib.parse import quote

logger = logging.getLogger(__name__)

class GoogleSearchAPI:
    def __init__(self):
        self.api_key = os.getenv('GOOGLE_API_KEY')
        self.search_engine_id = os.getenv('GOOGLE_SEARCH_ENGINE_ID')
        self.base_url = "https://www.googleapis.com/customsearch/v1"
        
        # בדיקה שהמפתחות קיימים
        if not self.api_key:
            raise ValueError("GOOGLE_API_KEY לא נמצא במשתני הסביבה")
        if not self.search_engine_id:
            raise ValueError("GOOGLE_SEARCH_ENGINE_ID לא נמצא במשתני הסביבה")
    
    async def search(self, query, num_results=5, language='he'):
        """ביצוע חיפוש ב-Google"""
        try:
            # הכנת הפרמטרים
            params = {
                'q': query,
                'key': self.api_key,
                'cx': self.search_engine_id,
                'num': min(num_results, 10),  # מקסימום 10 תוצאות
                'hl': language,  # שפת התוצאות
                'lr': f'lang_{language}',  # העדפת שפה
                'safe': 'medium'  # סינון תוכן
            }
            
            # ביצוע הבקשה
            response = requests.get(self.base_url, params=params, timeout=10)
            response.raise_for_status()
            
            data = response.json()
            
            # עיבוד התוצאות
            results = []
            for item in data.get('items', []):
                result = {
                    'title': item.get('title', 'ללא כותרת'),
                    'link': item.get('link', ''),
                    'snippet': item.get('snippet', 'ללא תיאור'),
                    'display_link': item.get('displayLink', ''),
                }
                results.append(result)
            
            search_info = {
                'total_results': data.get('searchInformation', {}).get('totalResults', '0'),
                'search_time': data.get('searchInformation', {}).get('searchTime', '0'),
                'results': results
            }
            
            return search_info
            
        except requests.RequestException as e:
            logger.error(f"Google Search API error: {e}")
            return None
        except Exception as e:
            logger.error(f"Unexpected error in Google search: {e}")
            return None

# יצירת אובייקט חיפוש גלובלי
google_search = GoogleSearchAPI()

async def search_command(update, context):
    """פקודת /search לחיפוש ב-Google"""
    if not context.args:
        await update.message.reply_text(
            "🔍 **שימוש בפקודת חיפוש:**\n\n"
            "/search [מילות החיפוש]\n\n"
            "**דוגמאות:**\n"
            "• /search מתכונים עוגות\n"
            "• /search חדשות ישראל היום\n"
            "• /search Python tutorials",
            parse_mode='Markdown'
        )
        return
    
    query = " ".join(context.args)
    
    # הודעת טעינה
    loading_msg = await update.message.reply_text("🔍 מחפש ב-Google...")
    
    try:
        # ביצוע החיפוש
        search_results = await google_search.search(query, num_results=5)
        
        if not search_results or not search_results['results']:
            await loading_msg.edit_text("❌ לא נמצאו תוצאות לחיפוש שלך.")
            return
        
        # בניית הודעת התוצאות
        results_text = f"🔍 **תוצאות חיפוש עבור:** {query}\n\n"
        results_text += f"📊 נמצאו {search_results['total_results']} תוצאות "
        results_text += f"({search_results['search_time']} שניות)\n\n"
        
        for i, result in enumerate(search_results['results'][:5], 1):
            results_text += f"**{i}. {result['title']}**\n"
            results_text += f"🔗 {result['display_link']}\n"
            results_text += f"📝 {result['snippet'][:150]}...\n"
            results_text += f"[קישור מלא]({result['link']})\n\n"
        
        # בדיקת אורך ההודעה (מגבלת טלגרם: 4096 תווים)
        if len(results_text) > 4000:
            results_text = results_text[:3900] + "\n\n... (התוצאות קוצרו)"
        
        await loading_msg.edit_text(results_text, parse_mode='Markdown', disable_web_page_preview=True)
        
    except Exception as e:
        logger.error(f"Error in search command: {e}")
        await loading_msg.edit_text("❌ אירעה שגיאה בחיפוש. נסה שוב מאוחר יותר.")

# הוספה לבוט
application.add_handler(CommandHandler("search", search_command))</pre>
                            </div>
                        </div>

                        <div class="subtopic">
                            <h4>הגדרת משתני הסביבה:</h4>
                            <div class="code-block">
                                <h5>🔧 קובץ .env או Secret File ב-Render:</h5>
                                <pre># Google Custom Search API
GOOGLE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
GOOGLE_SEARCH_ENGINE_ID=0df4f2xxxxxxxx:abcd12345

# שאר המפתחות...
BOT_TOKEN=your_bot_token_here
MONGO_URI=your_mongo_uri_here</pre>
                            </div>
                        </div>

                        <div class="warning-box">
                            <h4>💰 מגבלות ועלויות:</h4>
                            <ul>
                                <li><strong>מכסה חינמית:</strong> 100 חיפושים ביום</li>
                                <li><strong>עלות נוספת:</strong> $5 לכל 1000 חיפושים נוספים</li>
                                <li><strong>מגבלת קצב:</strong> עד 10 תוצאות בחיפוש אחד</li>
                                <li><strong>המלצה:</strong> הגבל משתמשים ל-5 חיפושים ביום</li>
                            </ul>
                        </div>

                        <div class="tip-box">
                            <h4>💡 טיפים לשיפור החיפוש:</h4>
                            <ul>
                                <li><strong>Cache תוצאות:</strong> שמור חיפושים פופולריים במסד נתונים</li>
                                <li><strong>סינון תוכן:</strong> השתמש ב-safe search למניעת תוכן לא מתאים</li>
                                <li><strong>שפות מרובות:</strong> אפשר חיפוש בעברית ובאנגלית</li>
                                <li><strong>תחומים ספציפיים:</strong> הגבל חיפוש לאתרים מסוימים</li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Progress tracking and navigation highlighting
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.topic[id]');
            const navLinks = document.querySelectorAll('.sidebar a[data-section]');
            const totalSections = sections.length;
            
            let current = '';
            let sectionsViewed = 0;
            
            sections.forEach((section, index) => {
                const sectionTop = section.offsetTop - 200;
                const sectionBottom = sectionTop + section.clientHeight;
                
                if (scrollY >= sectionTop && scrollY < sectionBottom) {
                    current = section.getAttribute('id');
                }
                
                // Count sections that have been scrolled past
                if (scrollY >= sectionTop) {
                    sectionsViewed = Math.max(sectionsViewed, index + 1);
                }
            });
            
            // Update progress bar
            const progressPercent = Math.round((sectionsViewed / totalSections) * 100);
            const progressFill = document.getElementById('progressFill');
            const progressLabel = document.getElementById('progressLabel');
            
            if (progressFill && progressLabel) {
                progressFill.style.width = `${progressPercent}%`;
                progressLabel.textContent = `${progressPercent}% הושלם`;
            }
            
            // Highlight current section in navigation
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === current) {
                    link.style.background = '#4a5568';
                    link.style.color = '#81e6d9';
                    link.style.fontWeight = 'bold';
                } else {
                    link.style.background = '';
                    link.style.color = '#e2e8f0';
                    link.style.fontWeight = 'normal';
                }
            });
        });

        // Add copy buttons to code blocks
        document.addEventListener('DOMContentLoaded', function() {
            const codeBlocks = document.querySelectorAll('.code-block pre');
            
            codeBlocks.forEach((codeBlock, index) => {
                // Create copy button
                const copyButton = document.createElement('button');
                copyButton.innerHTML = '📋 העתק';
                copyButton.className = 'copy-button';
                copyButton.style.cssText = `
                    position: absolute;
                    top: 10px;
                    left: 10px;
                    background: #4a5568;
                    color: white;
                    border: none;
                    padding: 5px 10px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 0.8em;
                    z-index: 10;
                `;
                
                // Make code block container relative
                const container = codeBlock.closest('.code-block');
                container.style.position = 'relative';
                container.appendChild(copyButton);
                
                // Add click event
                copyButton.addEventListener('click', async () => {
                    try {
                        const text = codeBlock.textContent;
                        await navigator.clipboard.writeText(text);
                        
                        // Visual feedback
                        const originalText = copyButton.innerHTML;
                        copyButton.innerHTML = '✅ הועתק!';
                        copyButton.style.background = '#00b09b';
                        
                        setTimeout(() => {
                            copyButton.innerHTML = originalText;
                            copyButton.style.background = '#4a5568';
                        }, 2000);
                        
                    } catch (err) {
                        console.error('Copy failed:', err);
                        copyButton.innerHTML = '❌ שגיאה';
                        setTimeout(() => {
                            copyButton.innerHTML = '📋 העתק';
                        }, 2000);
                    }
                });
            });
        });

        // Add section completion markers
        function markSectionAsComplete(sectionId) {
            const navLink = document.querySelector(`a[data-section="${sectionId}"]`);
            if (navLink && !navLink.classList.contains('completed')) {
                navLink.classList.add('completed');
                navLink.style.textDecoration = 'line-through';
                navLink.style.opacity = '0.7';
                
                // Add completion emoji
                if (!navLink.textContent.includes('✅')) {
                    navLink.textContent = '✅ ' + navLink.textContent;
                }
            }
        }

        // Auto-mark sections as complete when scrolled past
        let sectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && entry.intersectionRatio > 0.8) {
                    markSectionAsComplete(entry.target.id);
                }
            });
        }, { threshold: 0.8 });

        // Observe all sections
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.topic[id]').forEach(section => {
                sectionObserver.observe(section);
            });
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + K for search (placeholder for future implementation)
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                // TODO: Implement search functionality
                console.log('Search shortcut pressed');
            }
            
            // Escape key to close quick start modal
            if (e.key === 'Escape') {
                closeQuickStart();
            }
            
            // Arrow keys for navigation between sections
            if (e.altKey) {
                const currentSection = document.querySelector('.topic[id]');
                if (e.key === 'ArrowDown') {
                    // Go to next section
                    const nextSection = currentSection?.nextElementSibling;
                    if (nextSection) {
                        nextSection.scrollIntoView({ behavior: 'smooth' });
                    }
                } else if (e.key === 'ArrowUp') {
                    // Go to previous section  
                    const prevSection = currentSection?.previousElementSibling;
                    if (prevSection) {
                        prevSection.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            }
        });

        // Quick Start Modal Functions
        function openQuickStart() {
            const modal = document.getElementById('quickStartModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
                
                // Add fade-in animation
                modal.style.opacity = '0';
                setTimeout(() => {
                    modal.style.transition = 'opacity 0.3s ease';
                    modal.style.opacity = '1';
                }, 10);
            }
        }

        function closeQuickStart() {
            const modal = document.getElementById('quickStartModal');
            if (modal) {
                modal.style.transition = 'opacity 0.3s ease';
                modal.style.opacity = '0';
                
                setTimeout(() => {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto'; // Restore scrolling
                }, 300);
            }
        }

        // Close modal when clicking outside content
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('quickStartModal');
            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeQuickStart();
                    }
                });
            }
        });
    </script>
</body>
</html>
